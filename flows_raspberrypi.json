[{"id":"30164f4b.56c61","type":"tab","label":"Scenari / 2","disabled":false,"info":""},{"id":"d39b9be8.95c69","type":"tab","label":"Pulsanti / 2","disabled":false,"info":""},{"id":"9980d99c.c2ed1","type":"tab","label":"Interruttori fisici / 2","disabled":false,"info":""},{"id":"bedae93a.1d692","type":"tab","label":"NoIP update","disabled":false,"info":""},{"id":"d60fc8e2.8b484","type":"tab","label":"Initialize","disabled":false,"info":""},{"id":"b7193843.fb8ae","type":"tab","label":"Mobile Voice","disabled":false,"info":""},{"id":"59b7c37b.f75cc4","type":"tab","label":"IP Check","disabled":false,"info":""},{"id":"e45dc9d3.dd3ac","type":"tab","label":"Logo Irrigazione manuale","disabled":false,"info":"First Step to adapt S7-node to logo-node\n\nLogoComfort side:\n\nTools-->Ethernet connections\nEnter:\n-LOGO IP adress\n-Subnet Mask\n-Default Gateway\n\nRight Click on Ethernet connections\nAdd Server connection --> S7 Connection\nDouble click on connection1\n\nTick Connect with an Operator Panel (OP)\nIt will change TSAP to 02.00\n\nTick Accept all connection requests (Or you know what you do)\n\nRemote Properties (Client) TSAP: 01.00\n\nRed Node Side:\nMenu (Upper Right)-->Import-->Clipboard\nPaste flow\nImport\n\nIn S7-LOGO8 Flow\nDouble click on LOGO8\nPLC properties (little pencil)\nChange for your Red Node IP adress\n\nDeploy\nNow you could already read all I/O of Logo\n"},{"id":"49caefca.99d708","type":"tab","label":"Logo irrigazione automatica","disabled":false,"info":""},{"id":"8145ac64.048b7","type":"tab","label":"TImer Irrigazione","disabled":false,"info":""},{"id":"515bde60.3de07","type":"tab","label":"test bigtimer","disabled":true,"info":""},{"id":"89eb750a.c6309","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"3ff1da.b6082e26","type":"ui_tab","z":"","name":"Casa Marco","icon":"dashboard","order":1},{"id":"7ee09098.d5df1","type":"ui_group","z":"","name":"Interruttori","tab":"3ff1da.b6082e26","disp":true,"width":"6","collapse":true},{"id":"9375a424.a02c68","type":"ui_group","z":"","name":"Scenari","tab":"3ff1da.b6082e26","disp":true,"width":"6","collapse":true},{"id":"df7df784.3d4498","type":"ui_group","z":"","name":"Admin tab","tab":"355004da.082674","order":2,"disp":false,"width":"6","collapse":false},{"id":"355004da.082674","type":"ui_tab","z":"","name":"Administration","icon":"dashboard","order":4},{"id":"11dded63.617353","type":"ui_tab","z":"","name":"Termometro","icon":"dashboard","order":2},{"id":"691cbe2b.29181","type":"ui_group","z":"","name":"Termometro","tab":"11dded63.617353","order":1,"disp":true,"width":"6","collapse":false},{"id":"ba13c465.38463","type":"s7 endpoint","z":"","address":"192.168.1.200","port":"102","rack":"0","slot":"2","localtsaphi":"01","localtsaplo":"00","remotetsaphi":"01","remotetsaplo":"00","connmode":"rack-slot","cycletime":"500","timeout":"1500","verbose":"default","name":"Logo Irrigazione","vartable":[{"addr":"DB1,X1064.2","name":"Q03"},{"addr":" DB1,X600.0","name":"irrigazione_zona_3"},{"addr":"DB1,601","name":"TImer"},{"addr":"DB1,X600.1","name":"irrigazione_zona_1"},{"addr":"DB1,X600.2","name":"irrigazione_zona_2"},{"addr":"DB1,X600.3","name":"irrigazione_orto"},{"addr":"DB1,X1064.3","name":"Q04"},{"addr":"DB1,X1064.0","name":"Q01"},{"addr":"DB1,X1064.1","name":"Q02"}]},{"id":"92d9fb4d.9968c","type":"ui_tab","z":"","name":"Irrigazione","icon":"call_split","order":4},{"id":"87c96fc2.8b524","type":"ui_group","z":"","name":"Comandi manuali","tab":"92d9fb4d.9968c","order":1,"disp":true,"width":"7","collapse":true},{"id":"4030d99d.8cb298","type":"ui_group","z":"","name":"Zona 1","tab":"92d9fb4d.9968c","order":2,"disp":true,"width":"7","collapse":true},{"id":"3d2d4886.4965b","type":"ui_group","z":"","name":"Zona 2","tab":"92d9fb4d.9968c","order":3,"disp":true,"width":"7","collapse":true},{"id":"5a4ba258.d8a4a4","type":"ui_group","z":"","name":"Zona 3","tab":"92d9fb4d.9968c","order":4,"disp":true,"width":"7","collapse":true},{"id":"d1f1e371.844e68","type":"ui_group","z":"","name":"Orto","tab":"92d9fb4d.9968c","order":5,"disp":true,"width":"7","collapse":true},{"id":"16329d6f.9c512b","type":"alexa-home-conf","z":"","username":"ilmola"},{"id":"ac2bdd0d.d21268","type":"alexa-home-conf","z":"","username":"forry2"},{"id":"2445e4a8.b0f22c","type":"ui_button","z":"30164f4b.56c61","name":"","group":"9375a424.a02c68","order":0,"width":0,"height":0,"passthru":true,"label":"A letto","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":410,"y":180,"wires":[["716746f2.67b82","5a633383.caae34"]]},{"id":"e81c48a6.1b77d8","type":"ui_button","z":"30164f4b.56c61","name":"","group":"9375a424.a02c68","order":0,"width":0,"height":0,"passthru":true,"label":"Amici in casa","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":450,"y":580,"wires":[["284986c0.acb8b2","bcab79ec.9b742"]]},{"id":"716746f2.67b82","type":"link out","z":"30164f4b.56c61","name":"","links":["cacddcf3.48d5e"],"x":735,"y":180,"wires":[]},{"id":"5a633383.caae34","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":610,"y":240,"wires":[["3f2e5c02.81c364","a3647fe4.3f4f88"]]},{"id":"3f2e5c02.81c364","type":"link out","z":"30164f4b.56c61","name":"","links":["5ccbbd4a.976ac4"],"x":755,"y":240,"wires":[]},{"id":"a3647fe4.3f4f88","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":610,"y":300,"wires":[["68bbcc46.c73274","917441ee.ddd4a8"]]},{"id":"68bbcc46.c73274","type":"link out","z":"30164f4b.56c61","name":"","links":["b67a6e1.5ce391"],"x":755,"y":300,"wires":[]},{"id":"917441ee.ddd4a8","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":610,"y":360,"wires":[["464306af.b3177","ad3b38f5.4e40b8"]]},{"id":"464306af.b3177","type":"link out","z":"30164f4b.56c61","name":"","links":["217bba75.0f410e"],"x":755,"y":360,"wires":[]},{"id":"ad3b38f5.4e40b8","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":610,"y":420,"wires":[["7195cd51.f5e82c"]]},{"id":"7195cd51.f5e82c","type":"link out","z":"30164f4b.56c61","name":"","links":["1c43ced4.a90439"],"x":755,"y":420,"wires":[]},{"id":"284986c0.acb8b2","type":"link out","z":"30164f4b.56c61","name":"","links":["24f2eba3.f55d4c"],"x":775,"y":580,"wires":[]},{"id":"9bf8e9e9.e40c7","type":"link out","z":"30164f4b.56c61","name":"","links":["1ff47a7.7569306"],"x":775,"y":640,"wires":[]},{"id":"d4a150a5.423288","type":"link out","z":"30164f4b.56c61","name":"","links":["bea04baa.6fa698"],"x":775,"y":700,"wires":[]},{"id":"2cffd1ec.0e97de","type":"link out","z":"30164f4b.56c61","name":"","links":["743a0a05.7e8b7c"],"x":775,"y":760,"wires":[]},{"id":"bcab79ec.9b742","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":640,"wires":[["9bf8e9e9.e40c7","92468c2b.827c98"]]},{"id":"92468c2b.827c98","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":700,"wires":[["d4a150a5.423288","c98c6d15.45594"]]},{"id":"c98c6d15.45594","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":760,"wires":[["2cffd1ec.0e97de"]]},{"id":"59193ec3.6b3f6","type":"ui_button","z":"30164f4b.56c61","name":"","group":"9375a424.a02c68","order":0,"width":0,"height":0,"passthru":true,"label":"Tv Serale","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":880,"y":180,"wires":[["5c5e85c.74859fc","4cbabfb4.a3f4f"]]},{"id":"5c5e85c.74859fc","type":"link out","z":"30164f4b.56c61","name":"","links":["452eae84.5236a"],"x":1215,"y":180,"wires":[]},{"id":"4cbabfb4.a3f4f","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1070,"y":240,"wires":[["9188a4e5.b4d3b","6c78649b.c759f4"]]},{"id":"9188a4e5.b4d3b","type":"link out","z":"30164f4b.56c61","name":"","links":["cacddcf3.48d5e"],"x":1215,"y":240,"wires":[]},{"id":"6c78649b.c759f4","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1070,"y":300,"wires":[["d1f4c7c1.b2ea4","b6b5a98e.ab29c"]]},{"id":"d1f4c7c1.b2ea4","type":"link out","z":"30164f4b.56c61","name":"","links":["5ccbbd4a.976ac4"],"x":1215,"y":300,"wires":[]},{"id":"b6b5a98e.ab29c","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1070,"y":360,"wires":[["c6ceda82.27b5f8","d45d910d.7acf68"]]},{"id":"c6ceda82.27b5f8","type":"link out","z":"30164f4b.56c61","name":"","links":["b67a6e1.5ce391"],"x":1215,"y":360,"wires":[]},{"id":"d45d910d.7acf68","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1070,"y":420,"wires":[["d0924eed.f56be"]]},{"id":"d0924eed.f56be","type":"link out","z":"30164f4b.56c61","name":"","links":["217bba75.0f410e"],"x":1215,"y":420,"wires":[]},{"id":"764b7fb6.6ab6a8","type":"ui_button","z":"30164f4b.56c61","name":"","group":"9375a424.a02c68","order":0,"width":0,"height":0,"passthru":true,"label":"Intrattenimento","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":1060,"y":600,"wires":[["3c5652bf.752476","cc9af899.b926f8"]]},{"id":"3c5652bf.752476","type":"link out","z":"30164f4b.56c61","name":"","links":["24f2eba3.f55d4c"],"x":1375,"y":600,"wires":[]},{"id":"632b00d6.fbffe","type":"link out","z":"30164f4b.56c61","name":"","links":["1ff47a7.7569306"],"x":1375,"y":660,"wires":[]},{"id":"88324e3.f34f0b","type":"link out","z":"30164f4b.56c61","name":"","links":["bea04baa.6fa698"],"x":1375,"y":720,"wires":[]},{"id":"4ac93d13.1fbe2c","type":"link out","z":"30164f4b.56c61","name":"","links":["217bba75.0f410e"],"x":1375,"y":780,"wires":[]},{"id":"cc9af899.b926f8","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1230,"y":660,"wires":[["632b00d6.fbffe","60af285f.e0fbf"]]},{"id":"60af285f.e0fbf","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1230,"y":720,"wires":[["88324e3.f34f0b","867c616.1564c2"]]},{"id":"867c616.1564c2","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1230,"y":780,"wires":[["4ac93d13.1fbe2c"]]},{"id":"6b88c64d.01116","type":"rpi-gpio out","z":"d39b9be8.95c69","name":"Sala 1","pin":"12","set":false,"level":"0","freq":"","out":"out","x":1270,"y":280,"wires":[]},{"id":"7d869a51.d1bfe4","type":"rpi-gpio out","z":"d39b9be8.95c69","name":"Sala 2","pin":"16","set":false,"level":"0","freq":"","out":"out","x":1390,"y":660,"wires":[]},{"id":"e59fe1eb.d1dab","type":"rpi-gpio out","z":"d39b9be8.95c69","name":"Sala 3","pin":"18","set":false,"level":"0","freq":"","out":"out","x":1430,"y":980,"wires":[]},{"id":"b12effaa.52f028","type":"rpi-gpio out","z":"d39b9be8.95c69","name":"Sala 4","pin":"26","set":false,"level":"0","freq":"","out":"out","x":1330,"y":1380,"wires":[]},{"id":"d451a21b.da7428","type":"rpi-gpio out","z":"d39b9be8.95c69","name":"Luce esterna","pin":"24","set":false,"level":"0","freq":"","out":"out","x":1350,"y":1760,"wires":[]},{"id":"4cd98f1a.f24e88","type":"rpi-gpio out","z":"d39b9be8.95c69","name":"Presa comandata","pin":"22","set":false,"level":"0","freq":"","out":"out","x":1290,"y":2060,"wires":[]},{"id":"e85a38d9.8080c","type":"link in","z":"d39b9be8.95c69","name":"pin-sala-1","links":["276fe9da.2ca106","d1dd5f68.0abb1","7455bdb2.614014"],"x":1175,"y":280,"wires":[["6b88c64d.01116"]]},{"id":"50d3eba3.d11d64","type":"link in","z":"d39b9be8.95c69","name":"pin-sala-2","links":["28e700f6.b5ab6"],"x":1215,"y":660,"wires":[["7d869a51.d1bfe4"]]},{"id":"ddd551be.eb963","type":"link in","z":"d39b9be8.95c69","name":"pin-sala-3","links":["8e36c045.c2cd08"],"x":1255,"y":980,"wires":[["e59fe1eb.d1dab"]]},{"id":"ff72631d.84b73","type":"link in","z":"d39b9be8.95c69","name":"pin-sala-4","links":["315ff83d.374f1"],"x":1195,"y":1380,"wires":[["b12effaa.52f028"]]},{"id":"411f02d7.65b46c","type":"link in","z":"d39b9be8.95c69","name":"pin-luceesterna","links":["e15ea30c.69ea78"],"x":1175,"y":1760,"wires":[["d451a21b.da7428"]]},{"id":"aef40649.b269a8","type":"link in","z":"d39b9be8.95c69","name":"","links":[],"x":1095,"y":2060,"wires":[["4cd98f1a.f24e88"]]},{"id":"253a5895.860588","type":"link in","z":"d39b9be8.95c69","name":"pin-presacomandata","links":["be91a8ea.b04c78"],"x":1095,"y":2060,"wires":[[]]},{"id":"688c72e.c589e0c","type":"change","z":"d39b9be8.95c69","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"sala1","pt":"global","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":280,"wires":[["276fe9da.2ca106","da51ff07.0a847"]]},{"id":"951c3374.d5c01","type":"change","z":"d39b9be8.95c69","name":"Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"},{"t":"set","p":"sala1","pt":"global","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":320,"wires":[["276fe9da.2ca106","da51ff07.0a847"]]},{"id":"276fe9da.2ca106","type":"link out","z":"d39b9be8.95c69","name":"","links":["e85a38d9.8080c"],"x":975,"y":280,"wires":[]},{"id":"24f2eba3.f55d4c","type":"link in","z":"d39b9be8.95c69","name":"action-sala1-on","links":["b160569c.942ab8","3d4c65d3.a83d7a","284986c0.acb8b2","3c5652bf.752476","8568eaa.d5ef898","b009b732.b3e8a","dc924008.d059b","b9db962f.ba7c18","4bc9a5d5.a5d9c4","a212634f.a532f","79080978.525e08","e3ae42a8.d53558"],"x":595,"y":240,"wires":[["688c72e.c589e0c"]]},{"id":"cacddcf3.48d5e","type":"link in","z":"d39b9be8.95c69","name":"action-sala1-off","links":["3c6b38b5.58a538","acf62283.879da","716746f2.67b82","9188a4e5.b4d3b","133cb0c2.2ad93f","897a5140.32371"],"x":515,"y":360,"wires":[["951c3374.d5c01"]]},{"id":"8b98eae3.254f6","type":"switch","z":"d39b9be8.95c69","name":"Toggle","property":"sala1","propertyType":"global","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":360,"wires":[["3c6b38b5.58a538"],["b160569c.942ab8"]]},{"id":"3c6b38b5.58a538","type":"link out","z":"d39b9be8.95c69","name":"","links":["cacddcf3.48d5e"],"x":855,"y":360,"wires":[]},{"id":"b160569c.942ab8","type":"link out","z":"d39b9be8.95c69","name":"","links":["24f2eba3.f55d4c"],"x":855,"y":400,"wires":[]},{"id":"9032c1a8.afebe","type":"link in","z":"d39b9be8.95c69","name":"action-sala1-toggle","links":["b7cedb5e.c45588","35b4356b.96a422"],"x":575,"y":420,"wires":[["8b98eae3.254f6","24b407f0.953048"]]},{"id":"4c8210a1.2b4be","type":"change","z":"d39b9be8.95c69","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"sala2","pt":"global","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":660,"wires":[["28e700f6.b5ab6","d6f62110.60ec6"]]},{"id":"470ca03b.a8e81","type":"change","z":"d39b9be8.95c69","name":"Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"},{"t":"set","p":"sala2","pt":"global","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":700,"wires":[["28e700f6.b5ab6","d6f62110.60ec6"]]},{"id":"28e700f6.b5ab6","type":"link out","z":"d39b9be8.95c69","name":"","links":["50d3eba3.d11d64"],"x":995,"y":660,"wires":[]},{"id":"1ff47a7.7569306","type":"link in","z":"d39b9be8.95c69","name":"action-sala2-on","links":["632b00d6.fbffe","80b90a53.4948","6112590.8110a28","9bf8e9e9.e40c7","55bb4db0.785544","c223153e.a868e","622f04a2.e5392c","f2ef7422.c6eb68","f59440a1.0eb54","ea11151b.8e31b8","79080978.525e08","cb82638f.829678"],"x":635,"y":660,"wires":[["4c8210a1.2b4be"]]},{"id":"5ccbbd4a.976ac4","type":"link in","z":"d39b9be8.95c69","name":"action-sala2-off","links":["cd0df881.a3929","68bacf07.09ba5","3f2e5c02.81c364","d1f4c7c1.b2ea4","133cb0c2.2ad93f","897a5140.32371"],"x":635,"y":700,"wires":[["470ca03b.a8e81"]]},{"id":"4e37e007.f77aa8","type":"switch","z":"d39b9be8.95c69","name":"Toggle","property":"sala2","propertyType":"global","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":730,"y":740,"wires":[["cd0df881.a3929"],["80b90a53.4948"]]},{"id":"cd0df881.a3929","type":"link out","z":"d39b9be8.95c69","name":"","links":["5ccbbd4a.976ac4"],"x":875,"y":740,"wires":[]},{"id":"80b90a53.4948","type":"link out","z":"d39b9be8.95c69","name":"","links":["1ff47a7.7569306"],"x":875,"y":780,"wires":[]},{"id":"712f86ce.9ab1e8","type":"link in","z":"d39b9be8.95c69","name":"action-sala2-toggle","links":["b0d51d7e.7e38b8"],"x":635,"y":740,"wires":[["4e37e007.f77aa8"]]},{"id":"da3cdb9e.d89988","type":"change","z":"d39b9be8.95c69","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"sala3","pt":"global","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":980,"wires":[["8e36c045.c2cd08","86fb7b0f.b475f8"]]},{"id":"bae64de3.9b3f48","type":"change","z":"d39b9be8.95c69","name":"Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"},{"t":"set","p":"sala3","pt":"global","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":1020,"wires":[["8e36c045.c2cd08","86fb7b0f.b475f8"]]},{"id":"8e36c045.c2cd08","type":"link out","z":"d39b9be8.95c69","name":"","links":["ddd551be.eb963"],"x":1035,"y":980,"wires":[]},{"id":"bea04baa.6fa698","type":"link in","z":"d39b9be8.95c69","name":"action-sala3-on","links":["b37b5ea0.c2237","5c01844f.671c74","d4a150a5.423288","88324e3.f34f0b","f5b1917.f2551f","e1b624d8.d7b29","875bf82f.7d60e8","8431732d.1ef2b8","ba1aab0c.514d08","75cea35c.1a861c","79080978.525e08","8df2d920.91ee08"],"x":675,"y":980,"wires":[["da3cdb9e.d89988"]]},{"id":"b67a6e1.5ce391","type":"link in","z":"d39b9be8.95c69","name":"action-sala3-off","links":["e06718be.6ac578","64134988.29f598","68bbcc46.c73274","c6ceda82.27b5f8","133cb0c2.2ad93f","897a5140.32371"],"x":675,"y":1020,"wires":[["bae64de3.9b3f48"]]},{"id":"5e025f1d.f5dee8","type":"switch","z":"d39b9be8.95c69","name":"Toggle","property":"sala3","propertyType":"global","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":1060,"wires":[["e06718be.6ac578"],["b37b5ea0.c2237"]]},{"id":"e06718be.6ac578","type":"link out","z":"d39b9be8.95c69","name":"","links":["b67a6e1.5ce391"],"x":915,"y":1060,"wires":[]},{"id":"b37b5ea0.c2237","type":"link out","z":"d39b9be8.95c69","name":"","links":["bea04baa.6fa698"],"x":915,"y":1100,"wires":[]},{"id":"31eef201.7ba0d6","type":"link in","z":"d39b9be8.95c69","name":"action-sala3-toggle","links":["db3cccde.52749"],"x":675,"y":1060,"wires":[["5e025f1d.f5dee8"]]},{"id":"ccc934bb.208978","type":"change","z":"d39b9be8.95c69","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"sala4","pt":"global","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1380,"wires":[["315ff83d.374f1","367aeb45.135c7c","615079f4.e9d9f"]]},{"id":"9bbfc739.dacc28","type":"change","z":"d39b9be8.95c69","name":"Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"},{"t":"set","p":"sala4","pt":"global","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1420,"wires":[["315ff83d.374f1","367aeb45.135c7c","b0590cd0.2a1aa8"]]},{"id":"315ff83d.374f1","type":"link out","z":"d39b9be8.95c69","name":"","links":["ff72631d.84b73"],"x":975,"y":1380,"wires":[]},{"id":"743a0a05.7e8b7c","type":"link in","z":"d39b9be8.95c69","name":"action-sala4-on","links":["16bf627b.c9c246","355fa1cb.c067ee","2f9f82c9.4a7286","2cffd1ec.0e97de","690d088e.d6cad"],"x":535,"y":1340,"wires":[["ccc934bb.208978"]]},{"id":"217bba75.0f410e","type":"link in","z":"d39b9be8.95c69","name":"action-sala4-off","links":["3b7d4073.79b12","73f50ba.7b2bbf4","464306af.b3177","d0924eed.f56be","4ac93d13.1fbe2c","133cb0c2.2ad93f","897a5140.32371"],"x":615,"y":1420,"wires":[["9bbfc739.dacc28"]]},{"id":"b20070d6.02ddc","type":"switch","z":"d39b9be8.95c69","name":"Toggle","property":"sala4","propertyType":"global","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":1460,"wires":[["3b7d4073.79b12","f509f2d7.73d448"],["355fa1cb.c067ee","177fb8cf.4f3657"]]},{"id":"3b7d4073.79b12","type":"link out","z":"d39b9be8.95c69","name":"","links":["217bba75.0f410e"],"x":855,"y":1460,"wires":[]},{"id":"355fa1cb.c067ee","type":"link out","z":"d39b9be8.95c69","name":"","links":["743a0a05.7e8b7c"],"x":855,"y":1500,"wires":[]},{"id":"658585f6.43f924","type":"link in","z":"d39b9be8.95c69","name":"action-sala4-toggle","links":["4dfb3297.6479dc"],"x":615,"y":1460,"wires":[["b20070d6.02ddc","b56fdda3.dfe4b"]]},{"id":"a3695b8.3998ea8","type":"change","z":"d39b9be8.95c69","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1760,"wires":[["85669d1c.5487a8"]]},{"id":"aa3c300c.2ebf18","type":"change","z":"d39b9be8.95c69","name":"Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1800,"wires":[["d17e3bc6.bf45b8"]]},{"id":"85669d1c.5487a8","type":"function","z":"d39b9be8.95c69","name":"luceesterna-on","func":"context.global.luceesterna=0\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":1760,"wires":[["e15ea30c.69ea78","398520d7.577df8"]]},{"id":"d17e3bc6.bf45b8","type":"function","z":"d39b9be8.95c69","name":"luceesterna-off","func":"context.global.luceesterna=1\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":1800,"wires":[["e15ea30c.69ea78","398520d7.577df8"]]},{"id":"e15ea30c.69ea78","type":"link out","z":"d39b9be8.95c69","name":"","links":["411f02d7.65b46c"],"x":975,"y":1760,"wires":[]},{"id":"ed7be55e.28e31","type":"link in","z":"d39b9be8.95c69","name":"action-luceesterna-on","links":["9d442de4.2cc25","7128efd5.2fd2b8"],"x":615,"y":1760,"wires":[["a3695b8.3998ea8"]]},{"id":"7462667b.55f678","type":"link in","z":"d39b9be8.95c69","name":"action-luceesterna-off","links":["475955fa.adc124","9bbbcdf.25a983"],"x":615,"y":1800,"wires":[["aa3c300c.2ebf18"]]},{"id":"f6dd0f0e.235ad8","type":"switch","z":"d39b9be8.95c69","name":"Toggle","property":"luceesterna","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":1840,"wires":[["475955fa.adc124"],["9d442de4.2cc25"]]},{"id":"475955fa.adc124","type":"link out","z":"d39b9be8.95c69","name":"","links":["7462667b.55f678"],"x":855,"y":1840,"wires":[]},{"id":"9d442de4.2cc25","type":"link out","z":"d39b9be8.95c69","name":"","links":["ed7be55e.28e31"],"x":855,"y":1880,"wires":[]},{"id":"52373f13.304ca","type":"link in","z":"d39b9be8.95c69","name":"action-luceesterna-toggle","links":[],"x":615,"y":1840,"wires":[["f6dd0f0e.235ad8"]]},{"id":"a1d13ae7.4e7368","type":"change","z":"d39b9be8.95c69","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":2060,"wires":[["a5b190c5.cd77d"]]},{"id":"c3f41fd8.e7a4","type":"change","z":"d39b9be8.95c69","name":"Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":2100,"wires":[["f851d300.4bb8c8"]]},{"id":"a5b190c5.cd77d","type":"function","z":"d39b9be8.95c69","name":"presacomandata-on","func":"context.global.presacomandata=0\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":2060,"wires":[["be91a8ea.b04c78","ad093dac.2cef7"]]},{"id":"f851d300.4bb8c8","type":"function","z":"d39b9be8.95c69","name":"presacomandata-off","func":"context.global.presacomandata=1\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":2100,"wires":[["be91a8ea.b04c78","ad093dac.2cef7"]]},{"id":"be91a8ea.b04c78","type":"link out","z":"d39b9be8.95c69","name":"","links":["253a5895.860588"],"x":995,"y":2060,"wires":[]},{"id":"452eae84.5236a","type":"link in","z":"d39b9be8.95c69","name":"action-presacomandata-on","links":["47eeeae6.77f5b4","81611e34.72f7f","5c5e85c.74859fc"],"x":575,"y":2060,"wires":[["a1d13ae7.4e7368"]]},{"id":"1c43ced4.a90439","type":"link in","z":"d39b9be8.95c69","name":"action-presacomandata-off","links":["420de263.78ef5c","e7a08629.4aad1","7195cd51.f5e82c"],"x":575,"y":2100,"wires":[["c3f41fd8.e7a4"]]},{"id":"17526339.55313d","type":"switch","z":"d39b9be8.95c69","name":"Toggle","property":"presacomandata","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":2140,"wires":[["420de263.78ef5c"],["47eeeae6.77f5b4"]]},{"id":"420de263.78ef5c","type":"link out","z":"d39b9be8.95c69","name":"","links":["1c43ced4.a90439"],"x":815,"y":2140,"wires":[]},{"id":"47eeeae6.77f5b4","type":"link out","z":"d39b9be8.95c69","name":"","links":["452eae84.5236a"],"x":815,"y":2180,"wires":[]},{"id":"b588bb60.dc973","type":"link in","z":"d39b9be8.95c69","name":"action-presacomandata-toggle","links":[],"x":575,"y":2140,"wires":[["17526339.55313d"]]},{"id":"da51ff07.0a847","type":"ui_switch","z":"d39b9be8.95c69","name":"","label":"Sala 1","tooltip":"","group":"7ee09098.d5df1","order":1,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","x":1230,"y":340,"wires":[["ff838a39.191678"]]},{"id":"d6f62110.60ec6","type":"ui_switch","z":"d39b9be8.95c69","name":"","label":"Sala 2","tooltip":"","group":"7ee09098.d5df1","order":2,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","x":1250,"y":720,"wires":[["80deec16.be5b28"]]},{"id":"86fb7b0f.b475f8","type":"ui_switch","z":"d39b9be8.95c69","name":"","label":"Sala 3","tooltip":"","group":"7ee09098.d5df1","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","x":1290,"y":1040,"wires":[["635b3cd1.8f5d4c"]]},{"id":"367aeb45.135c7c","type":"ui_switch","z":"d39b9be8.95c69","name":"","label":"Sala 4","tooltip":"","group":"7ee09098.d5df1","order":4,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","x":1230,"y":1440,"wires":[["f7e3c78.0d359b8"]]},{"id":"398520d7.577df8","type":"ui_switch","z":"d39b9be8.95c69","name":"","label":"Luce esterna","tooltip":"","group":"7ee09098.d5df1","order":5,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","x":1230,"y":1820,"wires":[["24365b1c.99b5ac"]]},{"id":"ad093dac.2cef7","type":"ui_switch","z":"d39b9be8.95c69","name":"","label":"Presa comandata","group":"7ee09098.d5df1","order":6,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","x":1170,"y":2140,"wires":[["cea76082.369f88"]]},{"id":"ff838a39.191678","type":"switch","z":"d39b9be8.95c69","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1370,"y":340,"wires":[["3d4c65d3.a83d7a"],["acf62283.879da"]]},{"id":"80deec16.be5b28","type":"switch","z":"d39b9be8.95c69","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1390,"y":720,"wires":[["55bb4db0.785544"],["68bacf07.09ba5"]]},{"id":"635b3cd1.8f5d4c","type":"switch","z":"d39b9be8.95c69","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":1060,"wires":[["5c01844f.671c74"],["64134988.29f598"]]},{"id":"f7e3c78.0d359b8","type":"switch","z":"d39b9be8.95c69","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1370,"y":1440,"wires":[["2f9f82c9.4a7286"],["73f50ba.7b2bbf4"]]},{"id":"24365b1c.99b5ac","type":"switch","z":"d39b9be8.95c69","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1370,"y":1820,"wires":[["7128efd5.2fd2b8"],["9bbbcdf.25a983"]]},{"id":"cea76082.369f88","type":"switch","z":"d39b9be8.95c69","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1330,"y":2140,"wires":[["81611e34.72f7f"],["e7a08629.4aad1"]]},{"id":"3d4c65d3.a83d7a","type":"link out","z":"d39b9be8.95c69","name":"","links":["24f2eba3.f55d4c"],"x":1535,"y":220,"wires":[]},{"id":"acf62283.879da","type":"link out","z":"d39b9be8.95c69","name":"","links":["cacddcf3.48d5e"],"x":1515,"y":340,"wires":[]},{"id":"55bb4db0.785544","type":"link out","z":"d39b9be8.95c69","name":"","links":["1ff47a7.7569306"],"x":1495,"y":700,"wires":[]},{"id":"68bacf07.09ba5","type":"link out","z":"d39b9be8.95c69","name":"","links":["5ccbbd4a.976ac4"],"x":1495,"y":740,"wires":[]},{"id":"5c01844f.671c74","type":"link out","z":"d39b9be8.95c69","name":"","links":["bea04baa.6fa698"],"x":1535,"y":1020,"wires":[]},{"id":"64134988.29f598","type":"link out","z":"d39b9be8.95c69","name":"","links":["b67a6e1.5ce391"],"x":1535,"y":1060,"wires":[]},{"id":"2f9f82c9.4a7286","type":"link out","z":"d39b9be8.95c69","name":"","links":["743a0a05.7e8b7c"],"x":1495,"y":1380,"wires":[]},{"id":"73f50ba.7b2bbf4","type":"link out","z":"d39b9be8.95c69","name":"","links":["217bba75.0f410e"],"x":1495,"y":1440,"wires":[]},{"id":"7128efd5.2fd2b8","type":"link out","z":"d39b9be8.95c69","name":"","links":["ed7be55e.28e31"],"x":1475,"y":1800,"wires":[]},{"id":"9bbbcdf.25a983","type":"link out","z":"d39b9be8.95c69","name":"","links":["7462667b.55f678"],"x":1475,"y":1840,"wires":[]},{"id":"81611e34.72f7f","type":"link out","z":"d39b9be8.95c69","name":"","links":["452eae84.5236a"],"x":1435,"y":2120,"wires":[]},{"id":"e7a08629.4aad1","type":"link out","z":"d39b9be8.95c69","name":"","links":["1c43ced4.a90439"],"x":1435,"y":2160,"wires":[]},{"id":"38bd0cfe.52b45c","type":"sensor-ds18b20","z":"30164f4b.56c61","name":"Termometro sala","topic":"","sensorid":"28-000007427f5f","timer":"30","repeat":true,"x":550,"y":1100,"wires":[["fecb2ea3.86996","d043bf5b.d24748","34e691ac.f8d20e","fde9bb8b.298eb8"]]},{"id":"3ce00626.dfe33a","type":"link in","z":"d39b9be8.95c69","name":"switch-presacomandata","links":["f17f0da5.cd7218"],"x":1035,"y":2160,"wires":[["ad093dac.2cef7"]]},{"id":"11e7c2ab.ea1155","type":"link in","z":"d39b9be8.95c69","name":"switch-luceesterna","links":[],"x":1115,"y":1860,"wires":[["398520d7.577df8"]]},{"id":"e461e2c0.9ee508","type":"link in","z":"d39b9be8.95c69","name":"switch-sala3","links":["c55a8fb2.a7f6a","6243736f.6abca4"],"x":1175,"y":1060,"wires":[["86fb7b0f.b475f8","5d399892.6aaf28"]]},{"id":"3958f106.53773e","type":"link in","z":"d39b9be8.95c69","name":"switch-sala2","links":["aacec195.9b4bd","abde8250.3a20e8"],"x":1135,"y":740,"wires":[["d6f62110.60ec6"]]},{"id":"b6a77c2e.f2e7d","type":"link in","z":"d39b9be8.95c69","name":"switch-sala1","links":["6a6bce42.3902e8","4fd5f255.b07814"],"x":1115,"y":360,"wires":[["da51ff07.0a847"]]},{"id":"ffbe2800.6e901","type":"link out","z":"d39b9be8.95c69","name":"","links":[],"x":895,"y":1740,"wires":[]},{"id":"346888bc.69c7a","type":"link in","z":"30164f4b.56c61","name":"scenery-aletto","links":["eeab2011.813858","1890b273.6d9e2e","6ce5686a.66aba"],"x":375,"y":120,"wires":[["2445e4a8.b0f22c"]]},{"id":"34ad765e.79620a","type":"link in","z":"30164f4b.56c61","name":"scenery-tvserale","links":["39352c15.83bdfc"],"x":835,"y":140,"wires":[["59193ec3.6b3f6"]]},{"id":"9f2c870c.0375c","type":"link in","z":"30164f4b.56c61","name":"scenery-amiciincasa","links":["9d464d7.c55a63"],"x":395,"y":520,"wires":[["e81c48a6.1b77d8"]]},{"id":"fae86c2e.e0ff38","type":"link in","z":"30164f4b.56c61","name":"scenery-intrattenimento","links":["c33600d0.6b66a8"],"x":995,"y":540,"wires":[["764b7fb6.6ab6a8"]]},{"id":"df42ee55.b3f6b8","type":"inject","z":"30164f4b.56c61","name":"","topic":"","payload":"LONG","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":410,"y":260,"wires":[["2445e4a8.b0f22c"]]},{"id":"10dd9822.ca0b08","type":"rpi-gpio in","z":"9980d99c.c2ed1","name":"Sala 2","pin":"11","intype":"up","debounce":"25","read":false,"x":210,"y":960,"wires":[["5e46b722.86d14","30b5bca9.5501f4"]]},{"id":"8568eaa.d5ef898","type":"link out","z":"9980d99c.c2ed1","name":"","links":["24f2eba3.f55d4c"],"x":1215,"y":1000,"wires":[]},{"id":"6112590.8110a28","type":"link out","z":"9980d99c.c2ed1","name":"","links":["1ff47a7.7569306"],"x":1215,"y":1040,"wires":[]},{"id":"cc13be87.75d4c8","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1110,"y":1040,"wires":[["6112590.8110a28"]]},{"id":"7f8aedf0.e12064","type":"switch","z":"9980d99c.c2ed1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"SHORT","vt":"str"},{"t":"eq","v":"MEDIUM","vt":"str"},{"t":"eq","v":"LONG","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":4,"x":930,"y":1300,"wires":[["68bd5b9e.7f504c"],[],["77089905.70c21","aedcb379.cbecb","b8186158.96635"],[]]},{"id":"64046e0e.349cf","type":"rpi-gpio in","z":"9980d99c.c2ed1","name":"Sala 3","pin":"13","intype":"up","debounce":"25","read":false,"x":390,"y":1280,"wires":[["5feec9c2.f7d43","99e49aa6.eb99a8"]]},{"id":"1cd34eaf.b057c1","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1110,"y":1000,"wires":[["8568eaa.d5ef898"]]},{"id":"b0d51d7e.7e38b8","type":"link out","z":"9980d99c.c2ed1","name":"","links":["712f86ce.9ab1e8"],"x":1215,"y":940,"wires":[]},{"id":"db3cccde.52749","type":"link out","z":"9980d99c.c2ed1","name":"","links":["31eef201.7ba0d6"],"x":1275,"y":1260,"wires":[]},{"id":"68bd5b9e.7f504c","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1130,"y":1260,"wires":[["db3cccde.52749"]]},{"id":"3b82f910.7a342e","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1100,"y":940,"wires":[["b0d51d7e.7e38b8"]]},{"id":"854e79d7.2557c","type":"rpi-gpio in","z":"9980d99c.c2ed1","name":"Sala 1","pin":"7","intype":"up","debounce":"25","read":false,"x":210,"y":560,"wires":[["f02d77bd.2fe9b8","d61c97af.93435","3aae8370.9f3cd4"]]},{"id":"afc4ff33.ae6fa","type":"switch","z":"9980d99c.c2ed1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"SHORT","vt":"str"},{"t":"eq","v":"MEDIUM","vt":"str"},{"t":"eq","v":"LONG","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":4,"x":940,"y":1600,"wires":[["d3ac4279.77f22","5c5808aa.835dc8"],[],["be75d222.5f5118","72841816.c7d9d8","c51d0e54.71acf","818d6b97.0beec"],[]]},{"id":"dfa34136.bd9e5","type":"rpi-gpio in","z":"9980d99c.c2ed1","name":"Sala 4","pin":"15","intype":"up","debounce":"25","read":false,"x":270,"y":1600,"wires":[["9e611231.62f88","eed69251.e3b19"]]},{"id":"d3ac4279.77f22","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1150,"y":1580,"wires":[["4dfb3297.6479dc"]]},{"id":"4dfb3297.6479dc","type":"link out","z":"9980d99c.c2ed1","name":"","links":["658585f6.43f924"],"x":1295,"y":1580,"wires":[]},{"id":"bf1f9ed6.573f5","type":"rpi-gpio out","z":"d39b9be8.95c69","name":"Cancello","pin":"23","set":false,"level":"0","freq":"","out":"out","x":940,"y":2300,"wires":[]},{"id":"2474102d.874bd","type":"ui_button","z":"d39b9be8.95c69","name":"","group":"7ee09098.d5df1","order":7,"width":0,"height":0,"passthru":false,"label":"Cancello","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"num","topic":"","x":580,"y":2300,"wires":[["f212f05c.170898"]]},{"id":"f212f05c.170898","type":"trigger","z":"d39b9be8.95c69","op1":"0","op2":"1","op1type":"num","op2type":"num","duration":"250","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":780,"y":2300,"wires":[["bf1f9ed6.573f5"]]},{"id":"f5d56722.0b9c48","type":"ui_button","z":"30164f4b.56c61","name":"","group":"df7df784.3d4498","order":4,"width":"0","height":"0","passthru":false,"label":"Restore temp data","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":550,"y":1280,"wires":[["d2c74233.b1d81"]]},{"id":"364c1234.5bfbbe","type":"file","z":"30164f4b.56c61","name":"","filename":"/tmp/chart.log","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1320,"y":1300,"wires":[[]]},{"id":"d2c74233.b1d81","type":"file in","z":"30164f4b.56c61","name":"","filename":"/tmp/chart.log","format":"utf8","sendError":true,"x":760,"y":1280,"wires":[["682892a.bf9adec"]]},{"id":"682892a.bf9adec","type":"json","z":"30164f4b.56c61","name":"","property":"payload","action":"","pretty":false,"x":730,"y":1220,"wires":[["d043bf5b.d24748"]]},{"id":"d31c844.91207f8","type":"function","z":"30164f4b.56c61","name":"","func":"if (msg.topic === \"save\") {\n    msg.payload = context.last;\n    return msg;\n}\nelse {\n    context.last = msg.payload;\n}\nreturn null;","outputs":1,"noerr":0,"x":1170,"y":1300,"wires":[["364c1234.5bfbbe"]]},{"id":"2c550db1.df89a2","type":"ui_button","z":"30164f4b.56c61","name":"","group":"df7df784.3d4498","order":3,"width":"0","height":"0","passthru":false,"label":"Save temp data","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"save","x":980,"y":1300,"wires":[["d31c844.91207f8"]]},{"id":"80773330.0f51f","type":"json","z":"30164f4b.56c61","name":"","property":"payload","action":"","pretty":false,"x":930,"y":1160,"wires":[["d31c844.91207f8"]]},{"id":"7cf20b8f.7629a4","type":"ui_button","z":"30164f4b.56c61","name":"","group":"df7df784.3d4498","order":0,"width":0,"height":0,"passthru":false,"label":"Reset Node-Red","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":530,"y":1380,"wires":[["2e48b1ce.fdc016","c5efe62d.fa6678"]]},{"id":"748164a6.9680b4","type":"exec","z":"30164f4b.56c61","command":"sudo systemctl restart nodered.service","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":1090,"y":1440,"wires":[[],[],[]]},{"id":"2e48b1ce.fdc016","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":1380,"wires":[["2c550db1.df89a2"]]},{"id":"c5efe62d.fa6678","type":"delay","z":"30164f4b.56c61","name":"","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":800,"y":1440,"wires":[["748164a6.9680b4"]]},{"id":"fecb2ea3.86996","type":"change","z":"30164f4b.56c61","name":"Set temperature","rules":[{"t":"set","p":"temperature","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":1100,"wires":[["20b0d4df.331044"]]},{"id":"20b0d4df.331044","type":"ui_template","z":"30164f4b.56c61","group":"691cbe2b.29181","name":"Termometro sala","order":0,"width":"6","height":"6","format":"<script src=\"/myjs/RGraph/RGraph.common.core.js\" ></script>\n<script src=\"/myjs/RGraph/RGraph.gauge.js\" ></script>\n\n<script language=\"javascript\" type=\"text/javascript\">\n\n           (function(scope){ \n                scope.$watch('msg', function(msg) {\n                   gauge3.value=[msg.temperature];\n                   gauge3.grow();\n                });\n            })(scope);\n            \n            var gauge3 = new RGraph.Gauge({\n                id: 'cvs',\n                min: 0,\n                max: 50,\n                value: [23],\n                options: {\n                    titleBottom: 'Sala',\n                    titleBottomSize: '16',\n                    titleBottomFont: 'Impact',\n                    titleBottomColor: '#ff8888',\n                    titleBottomPos: 0.25,\n                    backgroundColor: 'black',\n                    backgroundGradient: true,\n                    centerpinColor: '#666',\n                    needleSize: [100],\n                    needleColors: ['Gradient(transparent:yellow:orange:#ff8888:#ff8888)'],\n                    textColor: 'white',\n                    tickmarksBigColor: 'white',\n                    tickmarksMediumColor: 'white',\n                    tickmarksSmallColor: 'white',\n                    borderWidth: 1,\n                    borderOuter: '#666',\n                    borderInner: '#3333',\n                    colorsRanges: [\n                                     [0,10,'rgba(0,0,255,0.6)'], \n                                    [10,20,'rgba(0,128,255,0.6)'], \n                                    [20,30,'rgba(0,204,0,1)'], \n                                    [30,40,'rgba(255,255,0,1)'], \n                                    [40,50,'rgba(255,0,0,1)']\n                                  ],\n                    textAccessible: true\n                }\n            });\n            gauge3.grow();\n\n    </script>\n\n    <canvas id=\"cvs\" width=\"300\" height=\"300\">[No canvas support]</canvas>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":970,"y":1100,"wires":[[]]},{"id":"d043bf5b.d24748","type":"ui_chart","z":"30164f4b.56c61","name":"","group":"691cbe2b.29181","order":0,"width":"0","height":"0","label":"Temperatura 8h","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"10","ymax":"40","removeOlder":"8","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":2,"x":760,"y":1160,"wires":[["80773330.0f51f"],[]]},{"id":"24b407f0.953048","type":"debug","z":"d39b9be8.95c69","name":"SALA1TOGGLE","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":760,"y":440,"wires":[]},{"id":"e01a6d65.c7ecf8","type":"inject","z":"bedae93a.1d692","name":"Get IP","topic":"ip","payload":"eth0","payloadType":"str","repeat":"300","crontab":"","once":false,"onceDelay":"","x":120,"y":260,"wires":[["a704550e.d27f78"]]},{"id":"c0949b9a.8144e","type":"function","z":"bedae93a.1d692","name":"Compare IP","func":"context.lastip = context.lastip || 'initial';\nvar currentip = msg.payload;\n\nif (context.lastip == 'initial') {\n    context.lastip = currentip;\n}\nelse if (context.lastip != currentip) {\n    msg.payload = currentip;\n    context.lastip = currentip;\n    return msg;\n}\n\n","outputs":"1","noerr":0,"x":350,"y":460,"wires":[["760c9b51.22694c","c9bdc2ab.4f5528"]]},{"id":"a704550e.d27f78","type":"exec","z":"bedae93a.1d692","command":"wget -qO- http://bot.whatismyipaddress.com/ ; echo","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"Call IP - whatismyipaddress.com","x":360,"y":260,"wires":[["96541ef3.9b3bf","8ab7ab81.3de1"],[],[]]},{"id":"96541ef3.9b3bf","type":"switch","z":"bedae93a.1d692","name":"Integrity check","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":360,"y":360,"wires":[["c0949b9a.8144e","75d006c.d224c78"],[]]},{"id":"760c9b51.22694c","type":"http request","z":"bedae93a.1d692","name":"Update no-ip.com","method":"GET","url":"http://forry2:geminitx@dynupdate.no-ip.com/nic/update?hostname=ilmola.loginto.me&myip={{payload}}","tls":"","x":370,"y":560,"wires":[["1a635f6f.327771"]]},{"id":"579e0a64.55d014","type":"inject","z":"bedae93a.1d692","name":"Test IP address","topic":"","payload":"192.168.1.9","payloadType":"string","repeat":"","crontab":"","once":false,"x":140,"y":460,"wires":[["c0949b9a.8144e"]]},{"id":"8ab7ab81.3de1","type":"debug","z":"bedae93a.1d692","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":220,"wires":[]},{"id":"75d006c.d224c78","type":"debug","z":"bedae93a.1d692","name":"IP integrity check","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":723.88330078125,"y":348.8833312988281,"wires":[]},{"id":"c9bdc2ab.4f5528","type":"debug","z":"bedae93a.1d692","name":"COMPARE IP","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":729.88330078125,"y":437.8833312988281,"wires":[]},{"id":"1a635f6f.327771","type":"debug","z":"bedae93a.1d692","name":"UPDATE NOIP","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":694.88330078125,"y":563.88330078125,"wires":[]},{"id":"ddc38d90.cafc08","type":"inject","z":"d60fc8e2.8b484","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":250,"y":140,"wires":[["99e2f3de.37d0a"]]},{"id":"99e2f3de.37d0a","type":"change","z":"d60fc8e2.8b484","name":"","rules":[{"t":"set","p":"sala1","pt":"global","to":"OFF","tot":"str"},{"t":"set","p":"sala2","pt":"global","to":"OFF","tot":"str"},{"t":"set","p":"sala3","pt":"global","to":"OFF","tot":"str"},{"t":"set","p":"sala4","pt":"global","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":140,"wires":[[]]},{"id":"36e2733.c11330c","type":"switch","z":"9980d99c.c2ed1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"SHORT","vt":"str"},{"t":"eq","v":"MEDIUM","vt":"str"},{"t":"eq","v":"LONG","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":4,"x":930,"y":960,"wires":[["3b82f910.7a342e"],[],["1cd34eaf.b057c1","cc13be87.75d4c8"],[]]},{"id":"7b70e02b.c40f8","type":"inject","z":"9980d99c.c2ed1","name":"LUNGO","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":80,"wires":[["d1830d1a.5a8358","81f5fe43.99dc1"]]},{"id":"d1830d1a.5a8358","type":"change","z":"9980d99c.c2ed1","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":60,"wires":[["25aca68f.b5f9ca"]]},{"id":"81f5fe43.99dc1","type":"change","z":"9980d99c.c2ed1","name":"1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":100,"wires":[["c42e02b5.7c2d08"]]},{"id":"25aca68f.b5f9ca","type":"delay","z":"9980d99c.c2ed1","name":"0","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":60,"wires":[["f02d77bd.2fe9b8","d61c97af.93435"]]},{"id":"c42e02b5.7c2d08","type":"delay","z":"9980d99c.c2ed1","name":"3000ms","pauseType":"delay","timeout":"3000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":380,"y":100,"wires":[["f02d77bd.2fe9b8","d61c97af.93435"]]},{"id":"d5a5741a.c8d57","type":"inject","z":"9980d99c.c2ed1","name":"BREVE","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":160,"wires":[["366ae2cd.acc306","73dacad1.3dc95c"]]},{"id":"366ae2cd.acc306","type":"change","z":"9980d99c.c2ed1","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":140,"wires":[["b136a9aa.7c5b6"]]},{"id":"73dacad1.3dc95c","type":"change","z":"9980d99c.c2ed1","name":"1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":180,"wires":[["b4f7e5a9.16c7d8"]]},{"id":"b136a9aa.7c5b6","type":"delay","z":"9980d99c.c2ed1","name":"0","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":140,"wires":[["f02d77bd.2fe9b8","d61c97af.93435"]]},{"id":"b4f7e5a9.16c7d8","type":"delay","z":"9980d99c.c2ed1","name":"300ms","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":180,"wires":[["f02d77bd.2fe9b8","d61c97af.93435"]]},{"id":"d61c97af.93435","type":"function","z":"9980d99c.c2ed1","name":"Evaluate interval","func":"context.set(\"lastPress\", context.get(\"lastPress\") || null);\ncontext.set(\"listenToTimeouts\", context.get(\"listenToTimeouts\") || false);\n\n\n\nif ((msg.deltatime === undefined) && (msg.payload === 0)){\n    // pressione\n    context.set(\"listenToTimeouts\", true);\n    context.set(\"lastPress\", Date.now());\n    ///// return ({payload:\"pressione\"});\n    return;\n}\n\nif ((msg.deltatime === undefined) && (msg.payload === 1)){\n    // rilascio\n    context.set(\"listenToTimeouts\", false);\n    if (context.get(\"lastPress\") === null){\n        ///// return ({payload:\"rilascio non valido\"});\n        return;\n    }\n    else{\n        deltaTime = Date.now() - context.get(\"lastPress\");\n        context.set(\"lastPress\", null);\n        ///// return ({payload:\"rilascio con delta \" + deltaTime});\n        \n        if (deltaTime < 100){\n            return ({payload:\"SPIKE\"});\n        }\n        if (deltaTime < 500){\n            return ({payload:\"SHORT\"});\n        }\n        if (deltaTime < 1000){\n            return ({payload:\"MEDIUM\"});\n        }\n    }\n\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === true)){\n    // timeout\n    context.set(\"listenToTimeouts\", false);\n    ///// return ({payload:\"timeout\"});\n    return ({payload:\"LONG\"});\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === false)){\n    // timeout invalido\n    ///// return ({payload:\"timeout invalido\"});\n    return;\n}\n\n\n\n","outputs":1,"noerr":0,"x":600,"y":480,"wires":[["2a1616c.9c953ea","1eb7fc3.d845784"]]},{"id":"f02d77bd.2fe9b8","type":"interval-length","z":"9980d99c.c2ed1","format":"mills","bytopic":false,"minimum":"","maximum":"1000","window":"","timeout":true,"msgTimeout":"1001","minimumunit":"msecs","maximumunit":"msecs","windowunit":"msecs","msgTimeoutUnit":"msecs","reset":false,"startup":false,"msgField":"deltatime","timestampField":"timestamp","repeatTimeout":false,"name":"","x":360,"y":460,"wires":[[],["d61c97af.93435"]]},{"id":"2a1616c.9c953ea","type":"switch","z":"9980d99c.c2ed1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"SHORT","vt":"str"},{"t":"eq","v":"MEDIUM","vt":"str"},{"t":"eq","v":"LONG","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":4,"x":770,"y":380,"wires":[["35b4356b.96a422"],["35b4356b.96a422"],["1890b273.6d9e2e"],[]]},{"id":"35b4356b.96a422","type":"link out","z":"9980d99c.c2ed1","name":"","links":["9032c1a8.afebe"],"x":975,"y":360,"wires":[]},{"id":"1890b273.6d9e2e","type":"link out","z":"9980d99c.c2ed1","name":"","links":["346888bc.69c7a"],"x":975,"y":400,"wires":[]},{"id":"1eb7fc3.d845784","type":"debug","z":"9980d99c.c2ed1","name":"COMMAND-sala1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":834.4636840820312,"y":452.6041564941406,"wires":[]},{"id":"b0d60da5.869f1","type":"inject","z":"9980d99c.c2ed1","name":"MEDIO","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":240,"wires":[["d03711f3.96f2c","ef641b23.a79518"]]},{"id":"d03711f3.96f2c","type":"change","z":"9980d99c.c2ed1","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":220,"wires":[["7771780.be8eb08"]]},{"id":"ef641b23.a79518","type":"change","z":"9980d99c.c2ed1","name":"1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":260,"wires":[["a8b2b50c.7d08b8"]]},{"id":"7771780.be8eb08","type":"delay","z":"9980d99c.c2ed1","name":"0","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":220,"wires":[["f02d77bd.2fe9b8","d61c97af.93435"]]},{"id":"a8b2b50c.7d08b8","type":"delay","z":"9980d99c.c2ed1","name":"650ms","pauseType":"delay","timeout":"650","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":260,"wires":[["f02d77bd.2fe9b8","d61c97af.93435"]]},{"id":"5e46b722.86d14","type":"interval-length","z":"9980d99c.c2ed1","format":"mills","bytopic":false,"minimum":"","maximum":"1000","window":"","timeout":true,"msgTimeout":"1001","minimumunit":"msecs","maximumunit":"msecs","windowunit":"msecs","msgTimeoutUnit":"msecs","reset":false,"startup":false,"msgField":"deltatime","timestampField":"timestamp","repeatTimeout":false,"name":"","x":400,"y":880,"wires":[[],["30b5bca9.5501f4"]]},{"id":"30b5bca9.5501f4","type":"function","z":"9980d99c.c2ed1","name":"Evaluate interval","func":"context.set(\"lastPress\", context.get(\"lastPress\") || null);\ncontext.set(\"listenToTimeouts\", context.get(\"listenToTimeouts\") || false);\n\n\n\nif ((msg.deltatime === undefined) && (msg.payload === 0)){\n    // pressione\n    context.set(\"listenToTimeouts\", true);\n    context.set(\"lastPress\", Date.now());\n    ///// return ({payload:\"pressione\"});\n    return;\n}\n\nif ((msg.deltatime === undefined) && (msg.payload === 1)){\n    // rilascio\n    context.set(\"listenToTimeouts\", false);\n    if (context.get(\"lastPress\") === null){\n        ///// return ({payload:\"rilascio non valido\"});\n        return;\n    }\n    else{\n        deltaTime = Date.now() - context.get(\"lastPress\");\n        context.set(\"lastPress\", null);\n        ///// return ({payload:\"rilascio con delta \" + deltaTime});\n        \n        if (deltaTime < 100){\n            return ({payload:\"SPIKE\"});\n        }\n        if (deltaTime < 500){\n            return ({payload:\"SHORT\"});\n        }\n        if (deltaTime < 1000){\n            return ({payload:\"MEDIUM\"});\n        }\n    }\n\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === true)){\n    // timeout\n    context.set(\"listenToTimeouts\", false);\n    ///// return ({payload:\"timeout\"});\n    return ({payload:\"LONG\"});\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === false)){\n    // timeout invalido\n    ///// return ({payload:\"timeout invalido\"});\n    return;\n}\n\n\n\n","outputs":1,"noerr":0,"x":640,"y":960,"wires":[["36e2733.c11330c"]]},{"id":"5feec9c2.f7d43","type":"interval-length","z":"9980d99c.c2ed1","format":"mills","bytopic":false,"minimum":"","maximum":"1000","window":"","timeout":true,"msgTimeout":"1001","minimumunit":"msecs","maximumunit":"msecs","windowunit":"msecs","msgTimeoutUnit":"msecs","reset":false,"startup":false,"msgField":"deltatime","timestampField":"timestamp","repeatTimeout":false,"name":"","x":540,"y":1220,"wires":[[],["99e49aa6.eb99a8"]]},{"id":"99e49aa6.eb99a8","type":"function","z":"9980d99c.c2ed1","name":"Evaluate interval","func":"context.set(\"lastPress\", context.get(\"lastPress\") || null);\ncontext.set(\"listenToTimeouts\", context.get(\"listenToTimeouts\") || false);\n\n\n\nif ((msg.deltatime === undefined) && (msg.payload === 0)){\n    // pressione\n    context.set(\"listenToTimeouts\", true);\n    context.set(\"lastPress\", Date.now());\n    ///// return ({payload:\"pressione\"});\n    return;\n}\n\nif ((msg.deltatime === undefined) && (msg.payload === 1)){\n    // rilascio\n    context.set(\"listenToTimeouts\", false);\n    if (context.get(\"lastPress\") === null){\n        ///// return ({payload:\"rilascio non valido\"});\n        return;\n    }\n    else{\n        deltaTime = Date.now() - context.get(\"lastPress\");\n        context.set(\"lastPress\", null);\n        ///// return ({payload:\"rilascio con delta \" + deltaTime});\n        \n        if (deltaTime < 100){\n            return ({payload:\"SPIKE\"});\n        }\n        if (deltaTime < 500){\n            return ({payload:\"SHORT\"});\n        }\n        if (deltaTime < 1000){\n            return ({payload:\"MEDIUM\"});\n        }\n    }\n\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === true)){\n    // timeout\n    context.set(\"listenToTimeouts\", false);\n    ///// return ({payload:\"timeout\"});\n    return ({payload:\"LONG\"});\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === false)){\n    // timeout invalido\n    ///// return ({payload:\"timeout invalido\"});\n    return;\n}\n\n\n\n","outputs":1,"noerr":0,"x":740,"y":1280,"wires":[["7f8aedf0.e12064"]]},{"id":"9e611231.62f88","type":"interval-length","z":"9980d99c.c2ed1","format":"mills","bytopic":false,"minimum":"","maximum":"1000","window":"","timeout":true,"msgTimeout":"1001","minimumunit":"msecs","maximumunit":"msecs","windowunit":"msecs","msgTimeoutUnit":"msecs","reset":false,"startup":false,"msgField":"deltatime","timestampField":"timestamp","repeatTimeout":false,"name":"","x":460,"y":1560,"wires":[[],["eed69251.e3b19"]]},{"id":"eed69251.e3b19","type":"function","z":"9980d99c.c2ed1","name":"Evaluate interval","func":"context.set(\"lastPress\", context.get(\"lastPress\") || null);\ncontext.set(\"listenToTimeouts\", context.get(\"listenToTimeouts\") || false);\n\n\n\nif ((msg.deltatime === undefined) && (msg.payload === 0)){\n    // pressione\n    context.set(\"listenToTimeouts\", true);\n    context.set(\"lastPress\", Date.now());\n    ///// return ({payload:\"pressione\"});\n    return;\n}\n\nif ((msg.deltatime === undefined) && (msg.payload === 1)){\n    // rilascio\n    context.set(\"listenToTimeouts\", false);\n    if (context.get(\"lastPress\") === null){\n        ///// return ({payload:\"rilascio non valido\"});\n        return;\n    }\n    else{\n        deltaTime = Date.now() - context.get(\"lastPress\");\n        context.set(\"lastPress\", null);\n        ///// return ({payload:\"rilascio con delta \" + deltaTime});\n        \n        if (deltaTime < 100){\n            node.status({fill:\"red\",shape:\"dot\",text:\"SPIKE\"});\n            return ({payload:\"SPIKE\"});\n        }\n        if (deltaTime < 500){\n            node.status({fill:\"blue\",shape:\"dot\",text:\"SHORT\"});\n            return ({payload:\"SHORT\"});\n        }\n        if (deltaTime < 1000){\n            node.status({fill:\"green\",shape:\"dot\",text:\"MEDIUM\"});\n            return ({payload:\"MEDIUM\"});\n        }\n    }\n\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === true)){\n    // timeout\n    context.set(\"listenToTimeouts\", false);\n    ///// return ({payload:\"timeout\"});\n    node.status({fill:\"yellow\",shape:\"dot\",text:\"LONG\"});\n    return ({payload:\"LONG\"});\n    \n}\nif ((msg.deltatime !== undefined) && (context.get(\"listenToTimeouts\") === false)){\n    // timeout invalido\n    ///// return ({payload:\"timeout invalido\"});\n    return;\n}\n\n\n\n","outputs":1,"noerr":0,"x":660,"y":1600,"wires":[["afc4ff33.ae6fa","9c3a4429.50c3c8"]]},{"id":"77089905.70c21","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1130,"y":1320,"wires":[["dc924008.d059b"]]},{"id":"aedcb379.cbecb","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1130,"y":1360,"wires":[["c223153e.a868e"]]},{"id":"b8186158.96635","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1140,"y":1400,"wires":[["e1b624d8.d7b29"]]},{"id":"dc924008.d059b","type":"link out","z":"9980d99c.c2ed1","name":"","links":["24f2eba3.f55d4c"],"x":1275,"y":1320,"wires":[]},{"id":"c223153e.a868e","type":"link out","z":"9980d99c.c2ed1","name":"","links":["1ff47a7.7569306"],"x":1275,"y":1360,"wires":[]},{"id":"e1b624d8.d7b29","type":"link out","z":"9980d99c.c2ed1","name":"","links":["bea04baa.6fa698"],"x":1275,"y":1400,"wires":[]},{"id":"be75d222.5f5118","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1150,"y":1640,"wires":[["4bc9a5d5.a5d9c4"]]},{"id":"72841816.c7d9d8","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1150,"y":1680,"wires":[["f2ef7422.c6eb68"]]},{"id":"c51d0e54.71acf","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1160,"y":1720,"wires":[["8431732d.1ef2b8"]]},{"id":"4bc9a5d5.a5d9c4","type":"link out","z":"9980d99c.c2ed1","name":"","links":["24f2eba3.f55d4c"],"x":1295,"y":1640,"wires":[]},{"id":"f2ef7422.c6eb68","type":"link out","z":"9980d99c.c2ed1","name":"","links":["1ff47a7.7569306"],"x":1295,"y":1680,"wires":[]},{"id":"8431732d.1ef2b8","type":"link out","z":"9980d99c.c2ed1","name":"","links":["bea04baa.6fa698"],"x":1295,"y":1720,"wires":[]},{"id":"818d6b97.0beec","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"1500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1160,"y":1760,"wires":[["690d088e.d6cad"]]},{"id":"690d088e.d6cad","type":"link out","z":"9980d99c.c2ed1","name":"","links":["743a0a05.7e8b7c"],"x":1295,"y":1760,"wires":[]},{"id":"9c3a4429.50c3c8","type":"debug","z":"9980d99c.c2ed1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":870,"y":1480,"wires":[]},{"id":"fc563d94.6cef9","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":850,"y":1760,"wires":[["e3ae42a8.d53558"]]},{"id":"34d9cd73.3aa942","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":850,"y":1800,"wires":[["cb82638f.829678"]]},{"id":"51bd566c.2ebd38","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"750","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":850,"y":1840,"wires":[["8df2d920.91ee08"]]},{"id":"e3ae42a8.d53558","type":"link out","z":"9980d99c.c2ed1","name":"","links":["24f2eba3.f55d4c"],"x":995,"y":1760,"wires":[]},{"id":"cb82638f.829678","type":"link out","z":"9980d99c.c2ed1","name":"","links":["1ff47a7.7569306"],"x":995,"y":1800,"wires":[]},{"id":"8df2d920.91ee08","type":"link out","z":"9980d99c.c2ed1","name":"","links":["bea04baa.6fa698"],"x":995,"y":1840,"wires":[]},{"id":"15c98947.ecb63f","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":1880,"wires":[["16bf627b.c9c246"]]},{"id":"16bf627b.c9c246","type":"link out","z":"9980d99c.c2ed1","name":"","links":["743a0a05.7e8b7c"],"x":995,"y":1880,"wires":[]},{"id":"5d8b1666.8cfec8","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"1500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":1960,"wires":[["897a5140.32371"]]},{"id":"897a5140.32371","type":"link out","z":"9980d99c.c2ed1","name":"","links":["b67a6e1.5ce391","217bba75.0f410e","5ccbbd4a.976ac4","cacddcf3.48d5e"],"x":1015,"y":1960,"wires":[]},{"id":"604a595d.22de9","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"2500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":2020,"wires":[[]]},{"id":"747a2669.5d6688","type":"delay","z":"9980d99c.c2ed1","name":"","pauseType":"delay","timeout":"3000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":860,"y":2080,"wires":[["897a5140.32371"]]},{"id":"bfd3a6f9.8e83e8","type":"http in","z":"b7193843.fb8ae","name":"POST Request","url":"/assistente","method":"post","upload":false,"swaggerDoc":"","x":80,"y":60,"wires":[["97da9c2a.a13488","59ca1411.2c589c"]]},{"id":"97da9c2a.a13488","type":"debug","z":"b7193843.fb8ae","name":"Step 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":310,"y":60,"wires":[]},{"id":"59ca1411.2c589c","type":"function","z":"b7193843.fb8ae","name":"Filter undesired words","func":"var undesired = [\" il \",\"l'\",\" e \",\" ed \",\" o \",\" la \",\" le \",\" gli \",\" un \",\" una \",\" uni \",\" une \",\" di \",\" a \",\" al \",\" alla \",\" agli \",\" alle \",\" allo \",\" da \",\" in \",\" con \",\" su \",\" per \",\" tra \",\" fra \",\" del \",\" della \",\" delle \",\" degli \",\" dagli \",\" dalle \",\" dalla \",\" nella \",\" nelle \",\" negli \"];\n\n\nmsg.payload.text = \" \" + msg.payload.text + \" \";\n\nvar arrayLength = undesired.length;\nfor (var i = 0; i < arrayLength; i++) {\n    //alert(myStringArray[i]);\n    while (msg.payload.text.lastIndexOf(undesired[i]) > -1){\n        msg.payload.text = msg.payload.text.replace(undesired[i], \" \");\n    }\n}\n\n// removing rubbish\n/*\nmsg.payload.text = msg.payload.text.toLowerCase();\nmsg.payload.text = msg.payload.text.replace(\"il \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"la \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"le \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"gli \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"un \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"una \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"uni \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"une \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"di \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"a \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"da \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"in \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"con \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"su \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"per \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"tra \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"fra \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"del \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"della \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"delle \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"degli \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"dagli \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"dalle \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"dalla \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"nella \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"nelle \",\" \");\nmsg.payload.text = msg.payload.text.replace(\"negli \",\" \");\n*/\n\nmsg.payload.text = msg.payload.text.trim();\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":200,"wires":[["5710cca4.8b6714","a2561fe2.c0fdf"]]},{"id":"5710cca4.8b6714","type":"debug","z":"b7193843.fb8ae","name":"Step 2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":550,"y":120,"wires":[]},{"id":"a2561fe2.c0fdf","type":"function","z":"b7193843.fb8ae","name":"Analyze voice command","func":"var inputString = msg.payload.text;\nvar inputArray = inputString.split(\" \");\n\nvar successAnswers = [\n    \"Ricordati che Roberto ti guarda\",\n    \"Ricordati che Roberto ha fatto tutto l'impianto di casa tua aggratise\",\n    \"Roberto è un bravo ingegnere e tu non hai nemmeno la sciuco in casa\",\n    \"Ok sua maestà, provvedo subito\",\n    \"Agli ordini, sua magnificenza, eseguo immediatamente\",\n    \"Ma certo sua santità, non perdo un istante\",\n    \"Oh mio signore e padrone, eseguo all'istante\",\n    \"Mio unico signore, pendo dalle tue labbra\",\n    \"Sua eccellenza, lo consideri già fatto\",\n    \"Oh sommo signore degli eserciti, ci penso io\",\n    \"Sua perfettità, implemento immediatamente\",\n    \"Sua beatitudine, sono oltremodo onorata di servir li comodi suoi\",\n    \"Sua eccellenzità, qual onore sentire il suo comando nei miei confronti\",\n    \"O potentissimo, eccellentissimo, reverendissimo, me ne occupo subito\",\n    \"Oh sua divinità, sono umilmente ai suoi servizi\",\n    \"Sua bellissimità, ogni suo desiderio è un ordine\",\n    \"Ale, ferma tuo marito che sta giocando un po' troppo con l'assistente vocale\",\n    \"Aò, però nun me poi rompe così le scatole e continuà a comandà come se fossi nu servo tuo\",\n    \"Ma che mi hai preso per il tuo galoppino? Alzati e usa gli interruttori\"\n];\n\nmsg.payload.command = 0;\nmsg.payload.success = false;\n\n\nvar commandsArray = new Array(5);\nfor (i = 0; i < commandsArray.length; i++){\n    // 0 trash\n    // 1 spegni\n    // 2 accendi\n    // 3 aziona\n    // 4 esegui\n    commandsArray[i] = \"\";\n}\n\nvar command = 0;\n\n// accendi sala corridoio spegni camera salone\n\nfor (i = 0; i < inputArray.length; i++) {\n    switch (inputArray[i]){\n        case \"spegni\":\n            command = 1;\n            break;\n        case \"accendi\":\t\n            command = 2;\n            break;\n        case \"aziona\":\n        case \"attiva\":\n            command = 3;\n            break;\n        case \"esegui\":\t\n            command = 4;\n            break;\n        default:\n\t\t\tcommandsArray[command] += inputArray[i] + \" \";\n\t\t\tbreak;\n\t}\n} \n\nfor (i = 0; i < commandsArray.length; i++){\n    // 0 trash\n    // 1 spegni\n    // 2 accendi\n    // 3 aziona\n    commandsArray[i] = commandsArray[i].trim();\n}\n\nmsg.payload.commands = commandsArray;\nif (commandsArray[0].length > 0){\n    msg.payload.response = \"Sua maestà, c'è un errore nel comando\";\n}\nelse {\n    msg.payload.success = true;\n    msg.payload.response = successAnswers[Math.floor(Math.random() * successAnswers.length)];\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":200,"wires":[["999e0921.4a63a8","dbac190c.01d5d8","438b716c.7d363"]]},{"id":"999e0921.4a63a8","type":"function","z":"b7193843.fb8ae","name":"Put response into payload","func":"msg.payload = msg.payload.response;\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":200,"wires":[["5327da9.26ee724","59bcc480.c8052c"]]},{"id":"5327da9.26ee724","type":"http response","z":"b7193843.fb8ae","name":"Response","x":1220,"y":200,"wires":[]},{"id":"dbac190c.01d5d8","type":"debug","z":"b7193843.fb8ae","name":"Step 3","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":750,"y":120,"wires":[]},{"id":"6a8f318f.f0fab8","type":"http request","z":"b7193843.fb8ae","name":"","method":"POST","ret":"txt","url":"http://192.168.0.103:8080/assistente","tls":"","x":610,"y":880,"wires":[["77d98bd9.308d44"]]},{"id":"16e1bd13.aeea8b","type":"inject","z":"b7193843.fb8ae","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":880,"wires":[["eb457ae8.5c8f1"]]},{"id":"77d98bd9.308d44","type":"debug","z":"b7193843.fb8ae","name":"Response","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":770,"y":880,"wires":[]},{"id":"eb457ae8.5c8f1","type":"function","z":"b7193843.fb8ae","name":"a letto (voce)","func":"msg.payload = { text: \"attiva a letto\" };\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":880,"wires":[["6a8f318f.f0fab8"]]},{"id":"59bcc480.c8052c","type":"debug","z":"b7193843.fb8ae","name":"Response","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1120,"y":120,"wires":[]},{"id":"da82f86a.97091","type":"http in","z":"b7193843.fb8ae","name":"GET Request","url":"/assistente","method":"get","upload":false,"swaggerDoc":"","x":90,"y":100,"wires":[["59ca1411.2c589c","97da9c2a.a13488"]]},{"id":"438b716c.7d363","type":"function","z":"b7193843.fb8ae","name":"Split commands","func":"    // 0 trash\n    // 1 spegni\n    // 2 accendi\n    // 3 aziona / attiva\n    // 4 esegui\n\nvar trash = {payload: msg.payload.commands[0]};\nvar spegni = {payload: msg.payload.commands[1]};\nvar accendi = {payload: msg.payload.commands[2]};\nvar aziona = {payload: msg.payload.commands[3]};\nvar esegui = {payload: msg.payload.commands[4]};\n\n\nreturn [trash, spegni, accendi, aziona, esegui];","outputs":5,"noerr":0,"x":160,"y":500,"wires":[[],["63c81413.55cfcc"],["1ca2e1ae.2e7036"],["1019bac7.a8d715"],[]]},{"id":"1ca2e1ae.2e7036","type":"function","z":"b7193843.fb8ae","name":"accendi","func":"var newMsg = {};\nnewMsg.payload = 0;\nvar devices = msg.payload.toString();\n\nvar allowedDevices = [\n    \"sala 1\", \n    \"sala 2\", \n    \"sala 3\", \n    \"sala 4\",\n    \"luce esterna\"\n    ];\n\nfor (i = 0; i < allowedDevices.length; i++){\n    if (devices.indexOf(allowedDevices[i]) > -1){\n        devices = devices.replace(allowedDevices[i], \"\");\n        newMsg.topic = allowedDevices[i];\n        node.send(newMsg);\n    }\n}\n\n\nreturn;","outputs":1,"noerr":0,"x":560,"y":520,"wires":[["742f60cf.3badd","85ebd009.34043"]]},{"id":"5b92bdbf.bb76e4","type":"switch","z":"b7193843.fb8ae","name":"Switch Device","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"sala 1","vt":"str"},{"t":"eq","v":"sala 2","vt":"str"},{"t":"eq","v":"sala 3","vt":"str"},{"t":"eq","v":"sala 4","vt":"str"},{"t":"eq","v":"luce esterna","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":1040,"y":480,"wires":[["e20ff327.c4273","8d15c795.5401d"],["ed98c312.aa29a8","8d15c795.5401d"],["c3bd47ec.d7b4b8","8d15c795.5401d"],["b8f14496.bf3f28","8d15c795.5401d"],["aa4422.62ccd3e"]]},{"id":"63c81413.55cfcc","type":"function","z":"b7193843.fb8ae","name":"spegni","func":"var newMsg = {};\nnewMsg.payload = 1;\nvar devices = msg.payload.toString();\n\nvar allowedDevices = [\n    \"sala 1\", \n    \"sala 2\", \n    \"sala 3\", \n    \"sala 4\",\n    \"luce esterna\"\n    ];\n\nfor (i = 0; i < allowedDevices.length; i++){\n    if (devices.indexOf(allowedDevices[i]) > -1){\n        devices = devices.replace(allowedDevices[i], \"\");\n        newMsg.topic = allowedDevices[i];\n        node.send(newMsg);\n    }\n}\n\n\nreturn;","outputs":1,"noerr":0,"x":570,"y":480,"wires":[["742f60cf.3badd","85ebd009.34043"]]},{"id":"22fa6622.8e5902","type":"debug","z":"b7193843.fb8ae","name":"comando post coda","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1040,"y":340,"wires":[]},{"id":"85ebd009.34043","type":"debug","z":"b7193843.fb8ae","name":"comando pre coda","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":790,"y":340,"wires":[]},{"id":"742f60cf.3badd","type":"simple-queue","z":"b7193843.fb8ae","name":"100ms queue","firstMessageBypass":true,"bypassInterval":"100","x":780,"y":480,"wires":[["5b92bdbf.bb76e4","22fa6622.8e5902"]]},{"id":"e20ff327.c4273","type":"link out","z":"b7193843.fb8ae","name":"","links":["b96b0dc.e8885f"],"x":1255,"y":420,"wires":[]},{"id":"c3bd47ec.d7b4b8","type":"link out","z":"b7193843.fb8ae","name":"","links":["3dae5052.80419"],"x":1255,"y":500,"wires":[]},{"id":"b8f14496.bf3f28","type":"link out","z":"b7193843.fb8ae","name":"","links":["f3dda71.cd8dcd8"],"x":1255,"y":540,"wires":[]},{"id":"ed98c312.aa29a8","type":"link out","z":"b7193843.fb8ae","name":"","links":["b0898916.12ff18"],"x":1255,"y":460,"wires":[]},{"id":"aa4422.62ccd3e","type":"link out","z":"b7193843.fb8ae","name":"","links":["948e03a9.cd883"],"x":1255,"y":580,"wires":[]},{"id":"8d15c795.5401d","type":"debug","z":"b7193843.fb8ae","name":"Uscita","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1310,"y":340,"wires":[]},{"id":"5d399892.6aaf28","type":"debug","z":"d39b9be8.95c69","name":"interruttore sala 3","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1310,"y":1140,"wires":[]},{"id":"3aae8370.9f3cd4","type":"debug","z":"9980d99c.c2ed1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":430,"y":623,"wires":[]},{"id":"b96b0dc.e8885f","type":"link in","z":"d39b9be8.95c69","name":"voice-sala-1","links":["e20ff327.c4273"],"x":175,"y":300,"wires":[["1a1e87c3.a9d958"]]},{"id":"1a1e87c3.a9d958","type":"switch","z":"d39b9be8.95c69","name":"voce sala 1","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":300,"wires":[["688c72e.c589e0c"],["951c3374.d5c01"]]},{"id":"b0898916.12ff18","type":"link in","z":"d39b9be8.95c69","name":"voice-sala-2","links":["ed98c312.aa29a8"],"x":195,"y":680,"wires":[["77ed151f.5ff9cc"]]},{"id":"77ed151f.5ff9cc","type":"switch","z":"d39b9be8.95c69","name":"voce sala 2","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":680,"wires":[["4c8210a1.2b4be"],["470ca03b.a8e81"]]},{"id":"3dae5052.80419","type":"link in","z":"d39b9be8.95c69","name":"voice-sala-3","links":["c3bd47ec.d7b4b8"],"x":235,"y":1000,"wires":[["b410319f.a6ac3"]]},{"id":"b410319f.a6ac3","type":"switch","z":"d39b9be8.95c69","name":"voce sala 3","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":1000,"wires":[["da3cdb9e.d89988"],["bae64de3.9b3f48"]]},{"id":"f3dda71.cd8dcd8","type":"link in","z":"d39b9be8.95c69","name":"voice-sala-4","links":["b8f14496.bf3f28"],"x":175,"y":1440,"wires":[["ada7132f.10aa28"]]},{"id":"ada7132f.10aa28","type":"switch","z":"d39b9be8.95c69","name":"voce sala 4","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":1440,"wires":[["ccc934bb.208978"],["9bbfc739.dacc28"]]},{"id":"e689132c.68e9","type":"link in","z":"d39b9be8.95c69","name":"voice-luce-esterna","links":[],"x":195,"y":1760,"wires":[["51e3a86b.969ad"]]},{"id":"51e3a86b.969ad","type":"switch","z":"d39b9be8.95c69","name":"voce luce esterna","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":1760,"wires":[["a3695b8.3998ea8"],["aa3c300c.2ebf18"]]},{"id":"948e03a9.cd883","type":"link in","z":"d39b9be8.95c69","name":"voice-presa-comandata","links":["aa4422.62ccd3e"],"x":195,"y":2100,"wires":[["8aac7301.e70148"]]},{"id":"8aac7301.e70148","type":"switch","z":"d39b9be8.95c69","name":"voce presa comandata","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":2100,"wires":[["a1d13ae7.4e7368"],["c3f41fd8.e7a4"]]},{"id":"1019bac7.a8d715","type":"function","z":"b7193843.fb8ae","name":"aziona/attiva","func":"var newMsg = {};\nnewMsg.payload = 0;\nvar targets = msg.payload.toString();\n\nvar allowedTargets = [\n    \"letto\", \n    \"tv serale\", \n    \"amici casa\", \n    \"intrattenimento\"\n    ];\n\nfor (i = 0; i < allowedTargets.length; i++){\n    if (targets.indexOf(allowedTargets[i]) > -1){\n        targets = targets.replace(allowedTargets[i], \"\");\n        newMsg.topic = allowedTargets[i];\n        node.send(newMsg);\n    }\n}\n\n\nreturn;","outputs":1,"noerr":0,"x":550,"y":560,"wires":[["e296dc1b.390758"]]},{"id":"e296dc1b.390758","type":"switch","z":"b7193843.fb8ae","name":"Switch Scenery","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"letto","vt":"str"},{"t":"eq","v":"tv serale","vt":"str"},{"t":"eq","v":"amici casa","vt":"str"},{"t":"eq","v":"intrattenimento","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":1040,"y":680,"wires":[["6ce5686a.66aba"],["39352c15.83bdfc"],["9d464d7.c55a63"],["c33600d0.6b66a8"]]},{"id":"6ce5686a.66aba","type":"link out","z":"b7193843.fb8ae","name":"","links":["346888bc.69c7a"],"x":1255,"y":640,"wires":[]},{"id":"39352c15.83bdfc","type":"link out","z":"b7193843.fb8ae","name":"","links":["34ad765e.79620a"],"x":1255,"y":680,"wires":[]},{"id":"9d464d7.c55a63","type":"link out","z":"b7193843.fb8ae","name":"","links":["9f2c870c.0375c"],"x":1255,"y":720,"wires":[]},{"id":"c33600d0.6b66a8","type":"link out","z":"b7193843.fb8ae","name":"","links":["fae86c2e.e0ff38"],"x":1255,"y":760,"wires":[]},{"id":"477bf656.c490f","type":"inject","z":"b7193843.fb8ae","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":920,"wires":[["2db50781.eb6b5"]]},{"id":"2db50781.eb6b5","type":"function","z":"b7193843.fb8ae","name":"Intrattenimento (voce)","func":"msg.payload = { text: \"attiva intrattenimento\" };\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":920,"wires":[["6a8f318f.f0fab8"]]},{"id":"7f96c979.fade","type":"inject","z":"b7193843.fb8ae","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":960,"wires":[["918275c4.b74f48"]]},{"id":"918275c4.b74f48","type":"function","z":"b7193843.fb8ae","name":"amici in casa (voce)","func":"msg.payload = { text: \"attiva amici in casa\" };\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":960,"wires":[["6a8f318f.f0fab8"]]},{"id":"d03cdb5b.16788","type":"inject","z":"b7193843.fb8ae","name":"","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1000,"wires":[["1e72a904.bfce2f"]]},{"id":"1e72a904.bfce2f","type":"function","z":"b7193843.fb8ae","name":"tv serale (voce)","func":"msg.payload = { text: \"attiva tv serale\" };\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":1000,"wires":[["6a8f318f.f0fab8"]]},{"id":"e83395b8.87a23","type":"inject","z":"9980d99c.c2ed1","name":"tester","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":1400,"wires":[["79bbd8.65a5fc28","8918550c.e2f15"]]},{"id":"462a9c5d.0dbe24","type":"delay","z":"9980d99c.c2ed1","name":"100ms","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":430,"y":1460,"wires":[["69ba3294.2c31a4"]]},{"id":"79bbd8.65a5fc28","type":"change","z":"9980d99c.c2ed1","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":1380,"wires":[["69ba3294.2c31a4"]]},{"id":"8918550c.e2f15","type":"change","z":"9980d99c.c2ed1","name":"1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":1420,"wires":[["462a9c5d.0dbe24"]]},{"id":"69ba3294.2c31a4","type":"function","z":"9980d99c.c2ed1","name":"return","func":"\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":1420,"wires":[["eed69251.e3b19"]]},{"id":"5c5808aa.835dc8","type":"debug","z":"9980d99c.c2ed1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":1480,"wires":[]},{"id":"1f305949.34ab67","type":"inject","z":"d39b9be8.95c69","name":"SHORT","topic":"","payload":"SHORT","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":423,"y":1532,"wires":[["b20070d6.02ddc"]]},{"id":"a428ac64.b465f8","type":"ping","z":"59b7c37b.f75cc4","name":"Ping Router","host":"192.168.1.1","timer":"5","x":70,"y":160,"wires":[["d52dabc9.fe151","8e2f689d.a00a1"]]},{"id":"ccacea47.76a73","type":"exec","z":"59b7c37b.f75cc4","command":"sudo dhclient -r wlan0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"lose IP","x":930,"y":100,"wires":[["6d398ec8.1f3ae8"],[],[]]},{"id":"6d398ec8.1f3ae8","type":"exec","z":"59b7c37b.f75cc4","command":"sudo dhclient wlan0","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"get new IP","x":1130,"y":100,"wires":[[],[],[]]},{"id":"d52dabc9.fe151","type":"function","z":"59b7c37b.f75cc4","name":"False PINGs counter","func":"var falsePings = context.get(\"false-pings\") || 0;\n//node.warn(\"falsePings = \" + falsePings);\n\nif (msg.payload === false)\n{\n    falsePings = falsePings + 1;\n    context.set(\"false-pings\", falsePings);\n}\nelse\n{\n    falsePings = 0;\n    context.set(\"false-pings\", 0);\n}\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"falsePings = \" + falsePings + \" - lastPing = \" + msg.payload + \"ms\"});\n\n\n\nif ((falsePings > 0) && (falsePings % 10  === 0))\n{\n    if (context.get(\"false-pings\") >= 100)\n    {\n        //100 ping andati a vuoto --> reboot\n        node.warn(\"100 false pings, rebooting\");\n        context.set(\"false-pings\", 0);\n        return [null, msg];\n    }\n    else\n    {\n        //10x ping andati a vuoto --> reassign ip\n        node.warn(\"10x false pings, renewing IP\");\n        return [msg, null];\n    }\n}\n","outputs":2,"noerr":0,"x":300,"y":160,"wires":[["87ab2e71.926fd8"],["9dec8b05.1b3048","cfcce3b1.a0576"]]},{"id":"8e2f689d.a00a1","type":"debug","z":"59b7c37b.f75cc4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":250,"y":260,"wires":[]},{"id":"ec1d5ac0.95ea78","type":"exec","z":"59b7c37b.f75cc4","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"reboot PI","x":800,"y":220,"wires":[[],[],[]]},{"id":"29b180c9.991cc","type":"file","z":"59b7c37b.f75cc4","name":"Write to file","filename":"/home/pi/noderedipproblems.log","appendNewline":true,"createDir":false,"overwriteFile":"false","x":950,"y":160,"wires":[[]]},{"id":"9dec8b05.1b3048","type":"change","z":"59b7c37b.f75cc4","name":"Log timestamp","rules":[{"t":"set","p":"payload","pt":"msg","to":"$now()","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":160,"wires":[["af1adb50.f85ea"]]},{"id":"cfcce3b1.a0576","type":"delay","z":"59b7c37b.f75cc4","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":600,"y":220,"wires":[["ec1d5ac0.95ea78"]]},{"id":"af1adb50.f85ea","type":"function","z":"59b7c37b.f75cc4","name":"","func":"msg.payload = \"Reboot at   \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":160,"wires":[["29b180c9.991cc"]]},{"id":"87ab2e71.926fd8","type":"change","z":"59b7c37b.f75cc4","name":"Log timestamp","rules":[{"t":"set","p":"payload","pt":"msg","to":"$now()","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":100,"wires":[["21e1f0cb.ab6018"]]},{"id":"21e1f0cb.ab6018","type":"function","z":"59b7c37b.f75cc4","name":"","func":"msg.payload = \"Renew IP at \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":100,"wires":[["ccacea47.76a73"]]},{"id":"e04977c6.995328","type":"comment","z":"8145ac64.048b7","name":"","info":"nuova pagina irrigazone\n4 pulsanti per 4 zone:\nzona1 zona2 zona3 orto\n\n2 fasce orarie giornaliere per ciascuna zona, con durata\n","x":1600,"y":840,"wires":[]},{"id":"1b343cec.4fa523","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_zona3_fascia1","label":"","group":"5a4ba258.d8a4a4","order":1,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":400,"wires":[["51a13fd6.78d18"]]},{"id":"20f4aec7.b6307a","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_zona3_fascia1","label":"","group":"5a4ba258.d8a4a4","order":2,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1180,"y":440,"wires":[["7f902a78.32fd2c"]]},{"id":"8bc526d3.88a468","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia1_lunedi","group":"5a4ba258.d8a4a4","order":4,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":1,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":2060,"wires":[["d8ab2698.602358"]]},{"id":"edbaf636.cf3e","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia1_martedi","group":"5a4ba258.d8a4a4","order":5,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":1,\"giorno\":2}","payloadType":"json","topic":"","x":1290,"y":2100,"wires":[["d8ab2698.602358"]]},{"id":"1ac73c95.0c1603","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia1_mercoledi","group":"5a4ba258.d8a4a4","order":6,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":1,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":2140,"wires":[["d8ab2698.602358"]]},{"id":"55f36308.1be7bc","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia1_giovedi","group":"5a4ba258.d8a4a4","order":7,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":1,\"giorno\":4}","payloadType":"json","topic":"","x":1290,"y":2180,"wires":[["d8ab2698.602358"]]},{"id":"402fedd8.5191dc","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia1_venerdi","group":"5a4ba258.d8a4a4","order":8,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":1,\"giorno\":5}","payloadType":"json","topic":"","x":1290,"y":2220,"wires":[["d8ab2698.602358"]]},{"id":"685e1b75.86f224","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia1_sabato","group":"5a4ba258.d8a4a4","order":9,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":1,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":2260,"wires":[["d8ab2698.602358"]]},{"id":"4cc1bcdc.62b4ec","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia1_domenica","group":"5a4ba258.d8a4a4","order":10,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":1,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":2300,"wires":[["d8ab2698.602358"]]},{"id":"9032d2f9.15bae8","type":"comment","z":"8145ac64.048b7","name":"","info":"pulsanti grigi con scritta nera\nQuando sono attivi: Scelgo io il colore","x":1700,"y":1980,"wires":[]},{"id":"b3ccc3d0.307ed8","type":"function","z":"8145ac64.048b7","name":"Read from Array and Get Value","func":"var buttonsMap = global.get(\"buttonsMap\") || {};\n\n\nkey = msg.payload.zona + \"_\" + msg.payload.fascia  + \"_\" + msg.payload.giorno;\n\n\nbuttonsMap[key] = !buttonsMap[key] || false;\nglobal.set(\"buttonsMap\", buttonsMap);\nmsg.payload.value = buttonsMap[key];\n\n\n\nnode.status({fill:\"blue\",shape:\"dot\",text:buttonsMap[key]});\n\n\n\nmsg.payload.value = buttonsMap[key] || false;\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":1880,"wires":[["de375f14.8f494"]]},{"id":"9fe0f987.b353","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.zona","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":630,"y":1660,"wires":[["4bcb269d.d51518"],["e9bcdc8f.131f28"],["c53c1b6d.12df3","3253b44b.3ecce4"],["f033e8eb.189818"],["910ffa78.ca86e"]]},{"id":"c53c1b6d.12df3","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.fascia","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":2200,"wires":[["e9a09387.1c849"],["aab31654.202dd"]]},{"id":"e9a09387.1c849","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1030,"y":2200,"wires":[["8bc526d3.88a468"],["edbaf636.cf3e"],["1ac73c95.0c1603"],["55f36308.1be7bc"],["402fedd8.5191dc"],["685e1b75.86f224"],["4cc1bcdc.62b4ec"]]},{"id":"de375f14.8f494","type":"function","z":"8145ac64.048b7","name":"color","func":"switch (msg.payload.value){\n    case true:\n        msg.payload.background = \"#FFA500\";\n        break;\n    case false:\n        msg.payload.background = \"#949494\";\n        break;\n}\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1620,"wires":[["fc01dd38.610158","9fe0f987.b353"]]},{"id":"d8ab2698.602358","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1615,"y":2260,"wires":[]},{"id":"a59ed89d.b70f38","type":"link in","z":"8145ac64.048b7","name":"color_in","links":["d8ab2698.602358","44639f3c.80242","9c1dc73d.3455c","b2b7bb94.e769a","a9262430.b013a","b9150dfc.7813d","49c82b0a.dda7fc","8abe3ffe.247358"],"x":135,"y":1920,"wires":[["b3ccc3d0.307ed8"]]},{"id":"98504ae7.831658","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia2_lunedi","group":"5a4ba258.d8a4a4","order":14,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":2,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":2360,"wires":[["44639f3c.80242"]]},{"id":"e198bc33.c15cc8","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia2_martedi","group":"5a4ba258.d8a4a4","order":15,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":2,\"giorno\":2}","payloadType":"json","topic":"","x":1290,"y":2400,"wires":[["44639f3c.80242"]]},{"id":"cf5ad505.2e15d8","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia2_mercoledi","group":"5a4ba258.d8a4a4","order":16,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":2,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":2440,"wires":[["44639f3c.80242"]]},{"id":"34ed61db.a12196","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia2_giovedi","group":"5a4ba258.d8a4a4","order":17,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":2,\"giorno\":4}","payloadType":"json","topic":"","x":1290,"y":2480,"wires":[["44639f3c.80242"]]},{"id":"e4361d56.e65d6","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia2_venerdi","group":"5a4ba258.d8a4a4","order":18,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":2,\"giorno\":5}","payloadType":"json","topic":"","x":1290,"y":2520,"wires":[["44639f3c.80242"]]},{"id":"dc8aafc4.5de84","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia2_sabato","group":"5a4ba258.d8a4a4","order":19,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":2,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":2560,"wires":[["44639f3c.80242"]]},{"id":"83f165d7.3b6458","type":"ui_button","z":"8145ac64.048b7","name":"zona3_fascia2_domenica","group":"5a4ba258.d8a4a4","order":20,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":3,\"fascia\":2,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":2600,"wires":[["44639f3c.80242"]]},{"id":"aab31654.202dd","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1050,"y":2480,"wires":[["98504ae7.831658"],["e198bc33.c15cc8"],["cf5ad505.2e15d8"],["34ed61db.a12196"],["e4361d56.e65d6"],["dc8aafc4.5de84"],["83f165d7.3b6458"]]},{"id":"d446da37.f27d4","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_zona3_fascia2","label":"","group":"5a4ba258.d8a4a4","order":11,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":480,"wires":[["66d093cd.7360d4"]]},{"id":"4f9bd087.47f5d8","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_zona3_fascia2","label":"","group":"5a4ba258.d8a4a4","order":12,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1180,"y":520,"wires":[["b161f15c.157418"]]},{"id":"44639f3c.80242","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1615,"y":2500,"wires":[]},{"id":"37bdd284.d94dfe","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_zona2_fascia1","label":"","group":"3d2d4886.4965b","order":1,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":240,"wires":[["41c2ac2e.fe0354"]]},{"id":"dde8d893.0c6ac8","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_zona2_fascia1","label":"","group":"3d2d4886.4965b","order":2,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1180,"y":280,"wires":[["fd7b172c.d32d2"]]},{"id":"e9bcdc8f.131f28","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.fascia","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":1680,"wires":[["54b8c23f.06576c","6a1514b0.211234"],["b16439bb.48ad1"]]},{"id":"54b8c23f.06576c","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1030,"y":1540,"wires":[["7f667b50.4df934","9bdd57da.25102"],["ef015f18.607428"],["e526a1ad.17e9c8"],["66b41f8c.61cc3"],["b5c26861.d9e1b8"],["18a78d45.15bb2b"],["11b6be68.319f82"]]},{"id":"b16439bb.48ad1","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1030,"y":1820,"wires":[["9b482765.b3a3d"],["9bbcafec.b6aa2"],["516b97cd.2915d"],["9e5659d8.6e1e18"],["2c04ded0.a386a2"],["3aab1ded.378f82"],["1692d089.66c8ff"]]},{"id":"7f667b50.4df934","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia1_lunedi","group":"3d2d4886.4965b","order":4,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":1,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":1440,"wires":[["9c1dc73d.3455c"]]},{"id":"ef015f18.607428","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia1_martedi","group":"3d2d4886.4965b","order":5,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":1,\"giorno\":2}","payloadType":"json","topic":"","x":1290,"y":1480,"wires":[["9c1dc73d.3455c"]]},{"id":"e526a1ad.17e9c8","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia1_mercoledi","group":"3d2d4886.4965b","order":6,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":1,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":1520,"wires":[["9c1dc73d.3455c"]]},{"id":"66b41f8c.61cc3","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia1_giovedi","group":"3d2d4886.4965b","order":7,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":1,\"giorno\":4}","payloadType":"json","topic":"","x":1290,"y":1560,"wires":[["9c1dc73d.3455c"]]},{"id":"b5c26861.d9e1b8","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia1_venerdi","group":"3d2d4886.4965b","order":8,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":1,\"giorno\":5}","payloadType":"json","topic":"","x":1290,"y":1600,"wires":[["9c1dc73d.3455c"]]},{"id":"18a78d45.15bb2b","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia1_sabato","group":"3d2d4886.4965b","order":9,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":1,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":1640,"wires":[["9c1dc73d.3455c"]]},{"id":"11b6be68.319f82","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia1_domenica","group":"3d2d4886.4965b","order":10,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":1,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":1680,"wires":[["9c1dc73d.3455c"]]},{"id":"9c1dc73d.3455c","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1635,"y":1520,"wires":[]},{"id":"9b482765.b3a3d","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia2_lunedi","group":"3d2d4886.4965b","order":14,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":2,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":1740,"wires":[["b2b7bb94.e769a"]]},{"id":"9bbcafec.b6aa2","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia2_martedi","group":"3d2d4886.4965b","order":15,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":2,\"giorno\":2}","payloadType":"json","topic":"","x":1290,"y":1780,"wires":[["b2b7bb94.e769a"]]},{"id":"516b97cd.2915d","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia2_mercoledi","group":"3d2d4886.4965b","order":16,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":2,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":1820,"wires":[["b2b7bb94.e769a"]]},{"id":"9e5659d8.6e1e18","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia2_giovedi","group":"3d2d4886.4965b","order":17,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":2,\"giorno\":4}","payloadType":"json","topic":"","x":1290,"y":1860,"wires":[["b2b7bb94.e769a"]]},{"id":"2c04ded0.a386a2","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia2_venerdi","group":"3d2d4886.4965b","order":18,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":2,\"giorno\":5}","payloadType":"json","topic":"","x":1290,"y":1900,"wires":[["b2b7bb94.e769a"]]},{"id":"3aab1ded.378f82","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia2_sabato","group":"3d2d4886.4965b","order":19,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":2,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":1940,"wires":[["b2b7bb94.e769a"]]},{"id":"1692d089.66c8ff","type":"ui_button","z":"8145ac64.048b7","name":"zona2_fascia2_domenica","group":"3d2d4886.4965b","order":20,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":2,\"fascia\":2,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":1980,"wires":[["b2b7bb94.e769a"]]},{"id":"b2b7bb94.e769a","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1615,"y":1880,"wires":[]},{"id":"d96f94c6.b49308","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_zona2_fascia2","label":"","group":"3d2d4886.4965b","order":11,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":320,"wires":[["415231a5.907b08"]]},{"id":"ed6fedff.29e888","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_zona2_fascia2","label":"","group":"3d2d4886.4965b","order":12,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1180,"y":360,"wires":[["60beb393.03f134"]]},{"id":"b71fb087.ebe08","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_zona1_fascia1","label":"","group":"4030d99d.8cb298","order":1,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":80,"wires":[["a76a4e5c.d0148"]]},{"id":"c9bae894.66d9f8","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_zona1_fascia1","label":"","group":"4030d99d.8cb298","order":2,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1180,"y":120,"wires":[["c3eb5fcc.3c1608"]]},{"id":"166c3fa5.a0618","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_zona1_fascia2","label":"","group":"4030d99d.8cb298","order":11,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":160,"wires":[["e88b019.f303b"]]},{"id":"b3c0ca72.12b8b","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_zona1_fascia2","label":"","group":"4030d99d.8cb298","order":12,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1180,"y":200,"wires":[["b9707a8c.0fb63"]]},{"id":"4bcb269d.d51518","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.fascia","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":1120,"wires":[["bd3f6bf3.3977e"],["22a2a09a.26796"]]},{"id":"bd3f6bf3.3977e","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1030,"y":980,"wires":[["60382197.89e9c"],["70bcefb1.0d875"],["6493bc58.68359c"],["4fd6f3d6.cd910c"],["1ea4695d.d79cb7"],["a73ac9f5.6ec6d8"],["6af62fc8.1d955"]]},{"id":"22a2a09a.26796","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1030,"y":1240,"wires":[["d2374a95.fc00d"],["209c708c.d5c37"],["8384505b.340cc"],["17a35dde.58f94a"],["297bebf6.4133a4"],["3e9425c1.129d82"],["193d1a1d.420c86"]]},{"id":"60382197.89e9c","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia1_lunedi","group":"4030d99d.8cb298","order":4,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":1,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":840,"wires":[["a9262430.b013a"]]},{"id":"70bcefb1.0d875","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia1_martedi","group":"4030d99d.8cb298","order":5,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":1,\"giorno\":2}","payloadType":"json","topic":"","x":1290,"y":880,"wires":[["a9262430.b013a"]]},{"id":"6493bc58.68359c","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia1_mercoledi","group":"4030d99d.8cb298","order":6,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":1,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":920,"wires":[["a9262430.b013a"]]},{"id":"4fd6f3d6.cd910c","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia1_giovedi","group":"4030d99d.8cb298","order":7,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":1,\"giorno\":4}","payloadType":"json","topic":"","x":1290,"y":960,"wires":[["a9262430.b013a"]]},{"id":"1ea4695d.d79cb7","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia1_venerdi","group":"4030d99d.8cb298","order":8,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":1,\"giorno\":5}","payloadType":"json","topic":"","x":1290,"y":1000,"wires":[["a9262430.b013a"]]},{"id":"a73ac9f5.6ec6d8","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia1_sabato","group":"4030d99d.8cb298","order":9,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":1,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":1040,"wires":[["a9262430.b013a"]]},{"id":"6af62fc8.1d955","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia1_domenica","group":"4030d99d.8cb298","order":10,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":1,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":1080,"wires":[["a9262430.b013a"]]},{"id":"a9262430.b013a","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1595,"y":980,"wires":[]},{"id":"d2374a95.fc00d","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia2_lunedi","group":"4030d99d.8cb298","order":14,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":2,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":1140,"wires":[["b9150dfc.7813d"]]},{"id":"209c708c.d5c37","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia2_martedi","group":"4030d99d.8cb298","order":15,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":2,\"giorno\":2}","payloadType":"json","topic":"","x":1290,"y":1180,"wires":[["b9150dfc.7813d"]]},{"id":"8384505b.340cc","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia2_mercoledi","group":"4030d99d.8cb298","order":16,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":2,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":1220,"wires":[["b9150dfc.7813d"]]},{"id":"17a35dde.58f94a","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia2_giovedi","group":"4030d99d.8cb298","order":17,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":2,\"giorno\":4}","payloadType":"json","topic":"","x":1290,"y":1260,"wires":[["b9150dfc.7813d"]]},{"id":"297bebf6.4133a4","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia2_venerdi","group":"4030d99d.8cb298","order":18,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":2,\"giorno\":5}","payloadType":"json","topic":"","x":1290,"y":1300,"wires":[["b9150dfc.7813d"]]},{"id":"3e9425c1.129d82","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia2_sabato","group":"4030d99d.8cb298","order":19,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":2,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":1340,"wires":[["b9150dfc.7813d"]]},{"id":"193d1a1d.420c86","type":"ui_button","z":"8145ac64.048b7","name":"zona1_fascia2_domenica","group":"4030d99d.8cb298","order":20,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":1,\"fascia\":2,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":1380,"wires":[["b9150dfc.7813d"]]},{"id":"b9150dfc.7813d","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1635,"y":1280,"wires":[]},{"id":"e4bce99.4a51418","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_orto_fascia1","label":"","group":"d1f1e371.844e68","order":1,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":560,"wires":[["7faab652.4189d"]]},{"id":"5375f278.4765cc","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_orto_fascia1","label":"","group":"d1f1e371.844e68","order":2,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":600,"wires":[["53695488.519414"]]},{"id":"90ade384.e0648","type":"ui_text_input","z":"8145ac64.048b7","name":"ON_orto_fascia2","label":"","group":"d1f1e371.844e68","order":11,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":640,"wires":[["ae50693b.390de8"]]},{"id":"28d09a3.ad5cbe6","type":"ui_text_input","z":"8145ac64.048b7","name":"OFF_orto_fascia2","label":"","group":"d1f1e371.844e68","order":12,"width":"2","height":"1","passthru":false,"mode":"time","delay":300,"topic":"","x":1170,"y":680,"wires":[["9efaef8f.219278"]]},{"id":"ab4b581a.7b0818","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia1_lunedi","group":"d1f1e371.844e68","order":4,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":1,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":2720,"wires":[["49c82b0a.dda7fc"]]},{"id":"7d5d8491.560094","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia1_martedi","group":"d1f1e371.844e68","order":5,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":1,\"giorno\":2}","payloadType":"json","topic":"","x":1280,"y":2760,"wires":[["49c82b0a.dda7fc"]]},{"id":"c2bf4375.43fd88","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia1_mercoledi","group":"d1f1e371.844e68","order":6,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":1,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":2800,"wires":[["49c82b0a.dda7fc"]]},{"id":"8ceefba8.a06fb8","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia1_giovedi","group":"d1f1e371.844e68","order":7,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":1,\"giorno\":4}","payloadType":"json","topic":"","x":1280,"y":2840,"wires":[["49c82b0a.dda7fc"]]},{"id":"f26c73c7.857d58","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia1_venerdi","group":"d1f1e371.844e68","order":8,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":1,\"giorno\":5}","payloadType":"json","topic":"","x":1280,"y":2880,"wires":[["49c82b0a.dda7fc"]]},{"id":"6fa0c886.1bafc8","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia1_sabato","group":"d1f1e371.844e68","order":9,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":1,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":2920,"wires":[["49c82b0a.dda7fc"]]},{"id":"995b7482.9d8438","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia1_domenica","group":"d1f1e371.844e68","order":10,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":1,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":2960,"wires":[["49c82b0a.dda7fc"]]},{"id":"f033e8eb.189818","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.fascia","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":2860,"wires":[["9162e93a.fb3b88"],["f2a21d5.67d65e"]]},{"id":"9162e93a.fb3b88","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1030,"y":2860,"wires":[["ab4b581a.7b0818"],["7d5d8491.560094"],["c2bf4375.43fd88"],["8ceefba8.a06fb8"],["f26c73c7.857d58"],["6fa0c886.1bafc8"],["995b7482.9d8438"]]},{"id":"49c82b0a.dda7fc","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1615,"y":2920,"wires":[]},{"id":"99b8109b.e02f18","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia2_lunedi","group":"d1f1e371.844e68","order":14,"width":"1","height":"1","passthru":false,"label":"Lu","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":2,\"giorno\":1}","payloadType":"json","topic":"","x":1280,"y":3020,"wires":[["8abe3ffe.247358"]]},{"id":"774ee13a.4ecf48","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia2_martedi","group":"d1f1e371.844e68","order":15,"width":"1","height":"1","passthru":false,"label":"Ma","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":2,\"giorno\":2}","payloadType":"json","topic":"","x":1280,"y":3060,"wires":[["8abe3ffe.247358"]]},{"id":"8db9515a.9579f","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia2_mercoledi","group":"d1f1e371.844e68","order":16,"width":"1","height":"1","passthru":false,"label":"Me","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":2,\"giorno\":3}","payloadType":"json","topic":"","x":1290,"y":3100,"wires":[["8abe3ffe.247358"]]},{"id":"5c21d7c7.78561","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia2_giovedi","group":"d1f1e371.844e68","order":17,"width":"1","height":"1","passthru":false,"label":"Gi","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":2,\"giorno\":4}","payloadType":"json","topic":"","x":1280,"y":3140,"wires":[["8abe3ffe.247358"]]},{"id":"6a022873.dbfa7","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia2_venerdi","group":"d1f1e371.844e68","order":18,"width":"1","height":"1","passthru":false,"label":"Ve","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":2,\"giorno\":5}","payloadType":"json","topic":"","x":1280,"y":3180,"wires":[["8abe3ffe.247358"]]},{"id":"26966b82.d3871c","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia2_sabato","group":"d1f1e371.844e68","order":19,"width":"1","height":"1","passthru":false,"label":"Sa","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":2,\"giorno\":6}","payloadType":"json","topic":"","x":1280,"y":3220,"wires":[["8abe3ffe.247358"]]},{"id":"f5215f13.06411","type":"ui_button","z":"8145ac64.048b7","name":"zona4_fascia2_domenica","group":"d1f1e371.844e68","order":20,"width":"1","height":"1","passthru":false,"label":"Do","color":"","bgcolor":"{{msg.payload.background}}","icon":"","payload":"{\"zona\":4,\"fascia\":2,\"giorno\":7}","payloadType":"json","topic":"","x":1290,"y":3260,"wires":[["8abe3ffe.247358"]]},{"id":"f2a21d5.67d65e","type":"switch","z":"8145ac64.048b7","name":"","property":"payload.giorno","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":1050,"y":3140,"wires":[["99b8109b.e02f18"],["774ee13a.4ecf48"],["8db9515a.9579f"],["5c21d7c7.78561"],["6a022873.dbfa7"],["26966b82.d3871c"],["f5215f13.06411"]]},{"id":"8abe3ffe.247358","type":"link out","z":"8145ac64.048b7","name":"","links":["a59ed89d.b70f38"],"x":1615,"y":3160,"wires":[]},{"id":"97fd45b7.c281e8","type":"function","z":"8145ac64.048b7","name":"Read buttons state on Start","func":"var buttonsMap = global.get(\"buttonsMap\");\n\n\nvar newMsg = {};\n\n\nvar value;\n\nObject.keys(buttonsMap).forEach(function(key) {\n    \n    newMsg.payload = {zona: parseInt(key.substring(0,1)), fascia: parseInt(key.substring(2,3)), giorno: parseInt(key.substring(4,5)), value: buttonsMap[key]};\n    newMsg.key = key;\n    node.send(newMsg);\n    \n});","outputs":1,"noerr":0,"x":350,"y":1160,"wires":[["de375f14.8f494","929fa75b.cd209"]]},{"id":"d847620.70ce0a","type":"inject","z":"8145ac64.048b7","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":190,"y":1460,"wires":[["97fd45b7.c281e8"]]},{"id":"513c3cb4.72231c","type":"s7 out","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","variable":"irrigazione_orto","name":"irrigazione orto","x":1660,"y":680,"wires":[]},{"id":"d599427d.4c31f8","type":"trigger","z":"e45dc9d3.dd3ac","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1420,"y":680,"wires":[["513c3cb4.72231c"]]},{"id":"de4051d7.613ba","type":"ui_button","z":"e45dc9d3.dd3ac","name":"Irrigazione orto","group":"87c96fc2.8b524","order":7,"width":"4","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":480,"y":740,"wires":[["22c91733.8b9e68","3a9121a3.232bfe"]]},{"id":"c9afe06e.77a81","type":"delay","z":"e45dc9d3.dd3ac","name":"1s","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":910,"y":840,"wires":[["d7b8dcc4.98c7f"]]},{"id":"d7b8dcc4.98c7f","type":"function","z":"e45dc9d3.dd3ac","name":"Set off timer","func":"msg.delay = global.get(\"irrigazioneOrtoTimer\") * 60000;\n\nif (global.get(\"irrigazioneOrtoStatus\") === false){\n    msg.reset=true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":840,"wires":[["43147252.43cd0c","e11aa8.318d5d58"]]},{"id":"43147252.43cd0c","type":"delay","z":"e45dc9d3.dd3ac","name":"","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1260,"y":760,"wires":[["d599427d.4c31f8","51b2c1ba.36c9b8"]]},{"id":"cd25cdb0.92c6e8","type":"s7 out","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","variable":"irrigazione_zona_1","name":"irrigazione zona 1","x":1650,"y":1440,"wires":[]},{"id":"a3f32782.ec098","type":"trigger","z":"e45dc9d3.dd3ac","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1440,"y":1440,"wires":[["cd25cdb0.92c6e8"]]},{"id":"fc46749c.526818","type":"ui_button","z":"e45dc9d3.dd3ac","name":"Irrigazione zona 1","group":"87c96fc2.8b524","order":1,"width":"4","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":490,"y":1460,"wires":[["4749251.4414cdc","ae05ef0a.f5aa6"]]},{"id":"99365606.ca0ab","type":"delay","z":"e45dc9d3.dd3ac","name":"1s","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":910,"y":1580,"wires":[["cd62908.e856c7"]]},{"id":"cd62908.e856c7","type":"function","z":"e45dc9d3.dd3ac","name":"Set off timer","func":"msg.delay = global.get(\"irrigazioneZona1Timer\") * 60000;\n\nif (global.get(\"irrigazioneZona1Status\") === false){\n    msg.reset=true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":1580,"wires":[["6f37157d.b0ef94","7981ba5e.91532c"]]},{"id":"6f37157d.b0ef94","type":"delay","z":"e45dc9d3.dd3ac","name":"","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1260,"y":1500,"wires":[["a3f32782.ec098","47729d8a.5bed14"]]},{"id":"de8ad720.f477f8","type":"s7 out","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","variable":"irrigazione_zona_2","name":"irrigazione zona 2","x":1650,"y":2000,"wires":[]},{"id":"2c3e817a.ad033e","type":"trigger","z":"e45dc9d3.dd3ac","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1440,"y":2000,"wires":[["de8ad720.f477f8"]]},{"id":"e480ae82.453ea","type":"ui_button","z":"e45dc9d3.dd3ac","name":"Irrigazione zona 2","group":"87c96fc2.8b524","order":3,"width":"4","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":490,"y":2080,"wires":[["e1e925b3.0d3918","c7ce547f.6e3188"]]},{"id":"f9c3e80e.07bcf","type":"delay","z":"e45dc9d3.dd3ac","name":"1s","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":850,"y":2140,"wires":[["61124cf4.8e90dc"]]},{"id":"61124cf4.8e90dc","type":"function","z":"e45dc9d3.dd3ac","name":"Set off timer","func":"msg.delay = global.get(\"irrigazioneZona2Timer\") * 60000;\n\nif (global.get(\"irrigazioneZona2Status\") === false){\n    msg.reset=true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":2140,"wires":[["230ad59d.682b0a","8e391237.c4b4a8"]]},{"id":"230ad59d.682b0a","type":"delay","z":"e45dc9d3.dd3ac","name":"","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1220,"y":2080,"wires":[["2c3e817a.ad033e","8f1adae4.56ad5"]]},{"id":"48fff53b.f01b54","type":"function","z":"e45dc9d3.dd3ac","name":"Button Color","func":"var buttonString = \"\";\nswitch (msg.payload){\n    case true:\n        buttonString = \"ACCESO\";\n        buttonShape = \"dot\";\n        buttonFill = \"green\";\n        break;\n    case false:\n        buttonString = \"SPENTO\";\n        buttonShape = \"ring\";\n        buttonFill = \"blue\";\n        break;\n}\n\n\nnode.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\nif (msg.payload === true)\n{\n    msg.background = \"#00FF00\";\n}\nelse\n{\n    msg.background = \"#0094ce\";\n}\nmsg.buttonlabel = \"Orto\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":740,"wires":[["de4051d7.613ba"]]},{"id":"dc2aac83.69fff","type":"s7 in","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","mode":"single","variable":"Q04","diff":true,"name":"LOGO8 - Q4","x":110,"y":660,"wires":[["31e894ae.42079c","48fff53b.f01b54","988d876c.0b0f18"]]},{"id":"31e894ae.42079c","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneOrtoStatus","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":580,"wires":[[]]},{"id":"95d62242.ced438","type":"file","z":"e45dc9d3.dd3ac","name":"Write to logfile","filename":"/home/pi/logo_irrigazione.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1200,"y":600,"wires":[[]]},{"id":"988d876c.0b0f18","type":"function","z":"e45dc9d3.dd3ac","name":"Create Log Entry","func":"var currentTime = new Date();\nvar currentTimeMs = currentTime.getTime();\nvar currentTimeReadable = currentTime.toLocaleTimeString();\nvar currentTimeSeconds = Math.floor(currentTimeMs/1000);\n\nswitch (msg.topic){\n    case \"pulsante\":\n        messageSource = \"pulsante_dashboard_orto\";\n        break;\n    default:\n        messageSource = \"logo_irrigazione_Q04_\" + msg.payload;\n        break;\n}\n\n\nvar newline = \"\";\n\n// timestamp leggibile dell'evento corrente\nnewline += currentTime + \";\";\n// timestamp in millisecondi epoch\nnewline += currentTimeMs + \";\";\n// tipo evento\nnewline += messageSource + \";\";\n\n\nmsg.payload = newline;\nnode.status({fill:\"blue\",shape:\"dot\",text:currentTime.toString()});\n\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":600,"wires":[["95d62242.ced438"]]},{"id":"22c91733.8b9e68","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"pulsanteOrto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":580,"wires":[["988d876c.0b0f18"]]},{"id":"5407d439.38efb4","type":"s7 in","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","mode":"single","variable":"Q01","diff":true,"name":"LOGO8 - Q1","x":90,"y":1400,"wires":[["7ec8a637.7aede","250b2541.35ceaa","5b59c52c.38f29c"]]},{"id":"7ec8a637.7aede","type":"function","z":"e45dc9d3.dd3ac","name":"Button Color","func":"var buttonString = \"\";\nswitch (msg.payload){\n    case true:\n        buttonString = \"ACCESO\";\n        buttonShape = \"dot\";\n        buttonFill = \"green\";\n        break;\n    case false:\n        buttonString = \"SPENTO\";\n        buttonShape = \"ring\";\n        buttonFill = \"blue\";\n        break;\n}\n\n\nnode.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\nif (msg.payload === true)\n{\n    msg.background = \"#00FF00\";\n}\nelse\n{\n    msg.background = \"#0094ce\";\n}\nmsg.buttonlabel = \"Zona 1\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":1460,"wires":[["fc46749c.526818"]]},{"id":"250b2541.35ceaa","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneZona1Status","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":1300,"wires":[[]]},{"id":"d199cda2.2ffec8","type":"ui_numeric","z":"e45dc9d3.dd3ac","name":"minOrto","label":"min","group":"87c96fc2.8b524","order":8,"width":"2","height":"1","passthru":true,"topic":"","format":"{{value}}","min":"1","max":"60","step":1,"x":160,"y":1040,"wires":[["112b03f7.c02efc"]]},{"id":"112b03f7.c02efc","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneOrtoTimer","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":230,"y":1100,"wires":[[]]},{"id":"948bb5de.c7e348","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"irrigazioneOrtoTimer","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":210,"y":980,"wires":[["d199cda2.2ffec8"]]},{"id":"afaae7b3.4ccd08","type":"ui_numeric","z":"e45dc9d3.dd3ac","name":"min1","label":"min","group":"87c96fc2.8b524","order":2,"width":"2","height":"1","passthru":true,"topic":"","format":"{{value}}","min":"1","max":"60","step":1,"x":870,"y":1640,"wires":[["99bfdc6.6b9892"]]},{"id":"99bfdc6.6b9892","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneZona1Timer","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":1640,"wires":[[]]},{"id":"7ef6332b.06eafc","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"irrigazioneZona1Timer","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":640,"y":1640,"wires":[["afaae7b3.4ccd08"]]},{"id":"946542ee.b5f15","type":"ui_numeric","z":"e45dc9d3.dd3ac","name":"min2","label":"min","group":"87c96fc2.8b524","order":4,"width":"2","height":"1","passthru":true,"topic":"","format":"{{value}}","min":"1","max":"60","step":1,"x":830,"y":2260,"wires":[["9a100ff9.f85c08"]]},{"id":"9a100ff9.f85c08","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneZona2Timer","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":2260,"wires":[[]]},{"id":"e01ef2cd.afb6f8","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"irrigazioneZona2Timer","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":600,"y":2260,"wires":[["946542ee.b5f15"]]},{"id":"49b8e76d.287288","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneZona2Status","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":1920,"wires":[[]]},{"id":"f3b72bed.e75d48","type":"function","z":"e45dc9d3.dd3ac","name":"Button Color","func":"var buttonString = \"\";\nswitch (msg.payload){\n    case true:\n        buttonString = \"ACCESO\";\n        buttonShape = \"dot\";\n        buttonFill = \"green\";\n        break;\n    case false:\n        buttonString = \"SPENTO\";\n        buttonShape = \"ring\";\n        buttonFill = \"blue\";\n        break;\n}\n\n\nnode.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\nif (msg.payload === true)\n{\n    msg.background = \"#00FF00\";\n}\nelse\n{\n    msg.background = \"#0094ce\";\n}\nmsg.buttonlabel = \"Zona 2\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":2080,"wires":[["e480ae82.453ea"]]},{"id":"f32df150.add988","type":"s7 in","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","mode":"single","variable":"Q02","diff":true,"name":"LOGO8 - Q2","x":110,"y":2020,"wires":[["f3b72bed.e75d48","49b8e76d.287288","c776d392.32bb7"]]},{"id":"4749251.4414cdc","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"pulsanteZona1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1300,"wires":[["5b59c52c.38f29c"]]},{"id":"5b59c52c.38f29c","type":"function","z":"e45dc9d3.dd3ac","name":"Create Log Entry","func":"var currentTime = new Date();\nvar currentTimeMs = currentTime.getTime();\nvar currentTimeReadable = currentTime.toLocaleTimeString();\nvar currentTimeSeconds = Math.floor(currentTimeMs/1000);\n\nswitch (msg.topic){\n    case \"pulsante\":\n        messageSource = \"pulsante_dashboard:zona1\";\n        break;\n    default:\n        messageSource = \"logo_irrigazione_Q01_\" + msg.payload;\n        break;\n}\n\n\nvar newline = \"\";\n\n// timestamp leggibile dell'evento corrente\nnewline += currentTime + \";\";\n// timestamp in millisecondi epoch\nnewline += currentTimeMs + \";\";\n// tipo evento\nnewline += messageSource + \";\";\n\n\nmsg.payload = newline;\nnode.status({fill:\"blue\",shape:\"dot\",text:currentTime.toString()});\n\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":1300,"wires":[["b0e30758.2abef"]]},{"id":"b0e30758.2abef","type":"file","z":"e45dc9d3.dd3ac","name":"Logo irrigazione log","filename":"/home/pi/logo_irrigazione.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1360,"y":1300,"wires":[[]]},{"id":"e1e925b3.0d3918","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"pulsanteZona2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1920,"wires":[["c776d392.32bb7"]]},{"id":"c776d392.32bb7","type":"function","z":"e45dc9d3.dd3ac","name":"Create Log Entry","func":"var currentTime = new Date();\nvar currentTimeMs = currentTime.getTime();\nvar currentTimeReadable = currentTime.toLocaleTimeString();\nvar currentTimeSeconds = Math.floor(currentTimeMs/1000);\n\nswitch (msg.topic){\n    case \"pulsante\":\n        messageSource = \"pulsante_dashboard:zona2\";\n        break;\n    default:\n        messageSource = \"logo_irrigazione_Q02_\" + msg.payload;\n        break;\n}\n\n\nvar newline = \"\";\n\n// timestamp leggibile dell'evento corrente\nnewline += currentTime + \";\";\n// timestamp in millisecondi epoch\nnewline += currentTimeMs + \";\";\n// tipo evento\nnewline += messageSource + \";\";\n\n\nmsg.payload = newline;\nnode.status({fill:\"blue\",shape:\"dot\",text:currentTime.toString()});\n\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":1920,"wires":[["c2dfe319.57d918"]]},{"id":"c2dfe319.57d918","type":"file","z":"e45dc9d3.dd3ac","name":"Logo irrigazione log","filename":"/home/pi/logo_irrigazione.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1380,"y":1920,"wires":[[]]},{"id":"af73cb86.4a7b7","type":"s7 out","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","variable":"irrigazione_zona_3","name":"Irrigazione zona 3","x":1630,"y":2600,"wires":[]},{"id":"803fce96.ab772","type":"trigger","z":"e45dc9d3.dd3ac","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1420,"y":2600,"wires":[["af73cb86.4a7b7"]]},{"id":"ee86846.91b7ff8","type":"ui_button","z":"e45dc9d3.dd3ac","name":"Irrigazione zona 3","group":"87c96fc2.8b524","order":5,"width":"4","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":530,"y":2600,"wires":[["7fbd08bc.6821c8","c190c51f.6e4e9"]]},{"id":"373e941d.812ea4","type":"s7 in","z":"e45dc9d3.dd3ac","endpoint":"ba13c465.38463","mode":"single","variable":"Q03","diff":true,"name":"LOGO8 - Q3","x":110,"y":2560,"wires":[["324f7414.b84f6c","58049769.ab719","64ceaba.3af81d4","f1ab91b3.69fdb8"]]},{"id":"58049769.ab719","type":"function","z":"e45dc9d3.dd3ac","name":"Button Color","func":"var buttonString = \"\";\nswitch (msg.payload){\n    case true:\n        buttonString = \"ACCESO\";\n        buttonShape = \"dot\";\n        buttonFill = \"green\";\n        break;\n    case false:\n        buttonString = \"SPENTO\";\n        buttonShape = \"ring\";\n        buttonFill = \"blue\";\n        break;\n}\n\n\nnode.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\nif (msg.payload === true)\n{\n    msg.background = \"#00FF00\";\n}\nelse\n{\n    msg.background = \"#0094ce\";\n}\nmsg.buttonlabel = \"Zona 3\";\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":2600,"wires":[["ee86846.91b7ff8"]]},{"id":"324f7414.b84f6c","type":"debug","z":"e45dc9d3.dd3ac","name":"Q3 logo irrigazione","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":350,"y":2400,"wires":[]},{"id":"21befedd.dc1112","type":"ui_numeric","z":"e45dc9d3.dd3ac","name":"min3","label":"min","group":"87c96fc2.8b524","order":6,"width":"2","height":"1","passthru":true,"topic":"","format":"{{value}}","min":"1","max":"60","step":1,"x":700,"y":2840,"wires":[["23d887b6.f123a"]]},{"id":"23d887b6.f123a","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneZona3Timer","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":2840,"wires":[[]]},{"id":"92bd18a2.891ba","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"irrigazioneZona3Timer","payloadType":"global","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":470,"y":2840,"wires":[["21befedd.dc1112"]]},{"id":"9a87ff88.3caf68","type":"delay","z":"e45dc9d3.dd3ac","name":"","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1220,"y":2660,"wires":[["803fce96.ab772","4dc32a00.ecb01c"]]},{"id":"d5aaf0f0.7135d","type":"function","z":"e45dc9d3.dd3ac","name":"Set off timer","func":"msg.delay = global.get(\"irrigazioneZona3Timer\") * 60000;\n\nif (global.get(\"irrigazioneZona3Status\") === false){\n    msg.reset=true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":2700,"wires":[["9a87ff88.3caf68","88f349a9.8f0af8"]]},{"id":"64ceaba.3af81d4","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"irrigazioneZona3Status","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":2480,"wires":[[]]},{"id":"c555fd40.68696","type":"file","z":"e45dc9d3.dd3ac","name":"Logo irrigazione log","filename":"/home/pi/logo_irrigazione.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1170,"y":2420,"wires":[[]]},{"id":"f1ab91b3.69fdb8","type":"function","z":"e45dc9d3.dd3ac","name":"Create Log Entry","func":"var currentTime = new Date();\nvar currentTimeMs = currentTime.getTime();\nvar currentTimeReadable = currentTime.toLocaleTimeString();\nvar currentTimeSeconds = Math.floor(currentTimeMs/1000);\n\nswitch (msg.topic){\n    case \"pulsante\":\n        messageSource = \"pulsante_dashboard_zona3\";\n        break;\n    default:\n        messageSource = \"logo_irrigazione_Q03_\" + msg.payload;\n        break;\n}\n\n\nvar newline = \"\";\n\n// timestamp leggibile dell'evento corrente\nnewline += currentTime + \";\";\n// timestamp in millisecondi epoch\nnewline += currentTimeMs + \";\";\n// tipo evento\nnewline += messageSource + \";\";\n\n\nmsg.payload = newline;\nnode.status({fill:\"blue\",shape:\"dot\",text:currentTime.toString()});\n\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":2420,"wires":[["c555fd40.68696"]]},{"id":"cb21170f.90d338","type":"delay","z":"e45dc9d3.dd3ac","name":"1s","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":850,"y":2700,"wires":[["d5aaf0f0.7135d"]]},{"id":"7fbd08bc.6821c8","type":"change","z":"e45dc9d3.dd3ac","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"pulsanteZona3","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":2480,"wires":[["f1ab91b3.69fdb8"]]},{"id":"2ab9d798.e53cc8","type":"bigtimer","z":"515bde60.3de07","outtopic":"","outpayload1":"ONmqtt","outpayload2":"OFFmqtt","name":"Big Timer Costa De Nobili","comment":"","lat":"45.133333","lon":"9.383333","starttime":"1140","endtime":"1140","starttime2":"1140","endtime2":"1140","startoff":"11","endoff":"12","startoff2":0,"endoff2":0,"offs":0,"outtext1":"ONtext","outtext2":"OFFtext","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":470,"y":220,"wires":[["2c993a60.1308c6"],["466decae.5da96c"],["6c408c61.e9ee8c"]]},{"id":"b422b50.6b343c8","type":"function","z":"515bde60.3de07","name":"millis to mins","func":"msg.payload =  Math.floor(msg.payload / 60000) ;\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":620,"wires":[["a2f864d4.fbede8"]]},{"id":"2c993a60.1308c6","type":"debug","z":"515bde60.3de07","name":"FIRST","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":750,"y":120,"wires":[]},{"id":"466decae.5da96c","type":"debug","z":"515bde60.3de07","name":"SECOND","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":760,"y":180,"wires":[]},{"id":"6c408c61.e9ee8c","type":"debug","z":"515bde60.3de07","name":"THIRD","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":750,"y":240,"wires":[]},{"id":"ce066f7c.d3a4d","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":560,"wires":[["b422b50.6b343c8","167bf34e.61274d"]]},{"id":"a2f864d4.fbede8","type":"debug","z":"515bde60.3de07","name":"TIMESTAMP_INJECT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":300,"y":680,"wires":[]},{"id":"167bf34e.61274d","type":"debug","z":"515bde60.3de07","name":"TIMESTAMP_RAW","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":483,"y":559,"wires":[]},{"id":"18eed89b.b6aa87","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":100,"wires":[["2ab9d798.e53cc8"]]},{"id":"69f3cfc0.28b6a8","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":140,"wires":[["2ab9d798.e53cc8"]]},{"id":"c3a82d77.e19a1","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":180,"wires":[["2ab9d798.e53cc8"]]},{"id":"7afcc526.411014","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"manual","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":220,"wires":[["2ab9d798.e53cc8"]]},{"id":"14c74caf.ac53eb","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"sync","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":260,"wires":[["2ab9d798.e53cc8"]]},{"id":"27112c87.2287c4","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"stop","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":300,"wires":[["2ab9d798.e53cc8"]]},{"id":"ed186f99.37b878","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"on_override 19:55","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":340,"wires":[["2ab9d798.e53cc8"]]},{"id":"7b65d15.69a753","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"off_override 19:56","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":380,"wires":[["2ab9d798.e53cc8"]]},{"id":"5d7e3c7b.0226d4","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"timer 5","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":420,"wires":[["2ab9d798.e53cc8"]]},{"id":"cee876ea.d48fb8","type":"inject","z":"515bde60.3de07","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":500,"y":440,"wires":[["319822fc.4bd5de"]]},{"id":"319822fc.4bd5de","type":"function","z":"515bde60.3de07","name":"timestamp-to-weekday","func":"\nvar xx = new Date();\nxx.setTime(msg.payload); // javascript timestamps are in milliseconds\nmsg.payload= xx.getDay(); // the Day\n\n\nreturn msg;","outputs":1,"noerr":0,"x":709,"y":428,"wires":[["ec4b4078.6f0f1"]]},{"id":"ec4b4078.6f0f1","type":"debug","z":"515bde60.3de07","name":"day","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":901,"y":437,"wires":[]},{"id":"3a9121a3.232bfe","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneOrtoMode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":760,"wires":[["d599427d.4c31f8","9b6a34ed.274db"]]},{"id":"128457ce.c342d","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneOrtoMode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":860,"wires":[[]]},{"id":"2abbb938.522e1e","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneOrtoMode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1630,"y":820,"wires":[[]]},{"id":"e11aa8.318d5d58","type":"switch","z":"e45dc9d3.dd3ac","name":"","property":"reset","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1390,"y":840,"wires":[["2abbb938.522e1e"],["128457ce.c342d"]]},{"id":"3b97fdaa.184812","type":"comment","z":"e45dc9d3.dd3ac","name":"ORTO","info":"","x":180,"y":484,"wires":[]},{"id":"51b2c1ba.36c9b8","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneOrtoMode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":760,"wires":[[]]},{"id":"7faab652.4189d","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneOrtoStart1","rules":[{"t":"set","p":"irrigazioneOrtoStart1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":560,"wires":[[]]},{"id":"53695488.519414","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneOrtoStop1","rules":[{"t":"set","p":"irrigazioneOrtoStop1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":600,"wires":[[]]},{"id":"ae50693b.390de8","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneOrtoStart2","rules":[{"t":"set","p":"irrigazioneOrtoStart2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":640,"wires":[[]]},{"id":"9efaef8f.219278","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneOrtoStop2","rules":[{"t":"set","p":"irrigazioneOrtoStop2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":680,"wires":[[]]},{"id":"929fa75b.cd209","type":"debug","z":"8145ac64.048b7","name":"Read buttons state on Start","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":630,"y":1160,"wires":[]},{"id":"ae05ef0a.f5aa6","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneZona1Mode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":1480,"wires":[["a3f32782.ec098","a8105730.edf98"]]},{"id":"7981ba5e.91532c","type":"switch","z":"e45dc9d3.dd3ac","name":"","property":"reset","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1430,"y":1580,"wires":[["fe0b7049.96c9"],["f406b369.7ef33"]]},{"id":"47729d8a.5bed14","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneZona1Mode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":1500,"wires":[[]]},{"id":"fe0b7049.96c9","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneZona1Mode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":1560,"wires":[[]]},{"id":"f406b369.7ef33","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneZona1Mode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1660,"y":1600,"wires":[[]]},{"id":"c7ce547f.6e3188","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneZona2Mode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":2060,"wires":[["2c3e817a.ad033e","9b6610be.f4a358"]]},{"id":"8f1adae4.56ad5","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneZona2Mode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":2080,"wires":[[]]},{"id":"8e391237.c4b4a8","type":"switch","z":"e45dc9d3.dd3ac","name":"","property":"reset","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1350,"y":2160,"wires":[["8cd08da6.afd578"],["fa2196ed.d43bc8"]]},{"id":"8cd08da6.afd578","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneZona2Mode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1590,"y":2140,"wires":[[]]},{"id":"fa2196ed.d43bc8","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneZona2Mode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1580,"y":2180,"wires":[[]]},{"id":"c190c51f.6e4e9","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneZona3Mode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":760,"y":2600,"wires":[["803fce96.ab772","8216b7ea.dc1bc8"]]},{"id":"4dc32a00.ecb01c","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneZona3Mode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":2680,"wires":[[]]},{"id":"da29b2be.550668","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_OFF","rules":[{"t":"set","p":"irrigazioneZona3Mode","pt":"global","to":"MANUAL_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1610,"y":2740,"wires":[[]]},{"id":"88f349a9.8f0af8","type":"switch","z":"e45dc9d3.dd3ac","name":"","property":"reset","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1370,"y":2760,"wires":[["da29b2be.550668"],["f7bc784.7d21d08"]]},{"id":"f7bc784.7d21d08","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneZona3Mode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1600,"y":2780,"wires":[[]]},{"id":"51a13fd6.78d18","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona3Start1","rules":[{"t":"set","p":"irrigazioneZona3Start1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":400,"wires":[[]]},{"id":"7f902a78.32fd2c","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona3Stop1","rules":[{"t":"set","p":"irrigazioneZona3Stop1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":440,"wires":[[]]},{"id":"41c2ac2e.fe0354","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona2Start1","rules":[{"t":"set","p":"irrigazioneZona2Start1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":240,"wires":[[]]},{"id":"fd7b172c.d32d2","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona2Stop1","rules":[{"t":"set","p":"irrigazioneZona2Stop1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":280,"wires":[[]]},{"id":"a76a4e5c.d0148","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona1Start1","rules":[{"t":"set","p":"irrigazioneZona1Start1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":80,"wires":[[]]},{"id":"c3eb5fcc.3c1608","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona1Stop1","rules":[{"t":"set","p":"irrigazioneZona1Stop1","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":120,"wires":[[]]},{"id":"66d093cd.7360d4","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona3Start2","rules":[{"t":"set","p":"irrigazioneZona3Start2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":480,"wires":[[]]},{"id":"b161f15c.157418","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona3Stop2","rules":[{"t":"set","p":"irrigazioneZona3Stop2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":520,"wires":[[]]},{"id":"415231a5.907b08","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona2Start2","rules":[{"t":"set","p":"irrigazioneZona2Start2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":320,"wires":[[]]},{"id":"60beb393.03f134","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona2Stop2","rules":[{"t":"set","p":"irrigazioneZona2Stop2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":360,"wires":[[]]},{"id":"e88b019.f303b","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona1Start2","rules":[{"t":"set","p":"irrigazioneZona1Start2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":160,"wires":[[]]},{"id":"b9707a8c.0fb63","type":"change","z":"8145ac64.048b7","name":"Set irrigazioneZona1Stop2","rules":[{"t":"set","p":"irrigazioneZona1Stop2","pt":"global","to":"$floor(payload / 60000)%1440","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":200,"wires":[[]]},{"id":"1e77e99d.cac89e","type":"s7 out","z":"49caefca.99d708","endpoint":"ba13c465.38463","variable":"irrigazione_orto","name":"irrigazione orto","x":1620,"y":180,"wires":[]},{"id":"204e1718.a8f13","type":"inject","z":"49caefca.99d708","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":480,"wires":[["ebe840aa.12ccc"]]},{"id":"30dba9bf.3dcdce","type":"function","z":"49caefca.99d708","name":"Get Day and Minute","func":"switch (msg.myday){\n    case \"Mon\":\n        msg.weekday = 1;\n        break;\n    case \"Tue\":\n        msg.weekday = 2;\n        break;\n    case \"Wed\":\n        msg.weekday = 3;\n        break;\n    case \"Thu\":\n        msg.weekday = 4;\n        break;\n    case \"Fri\":\n        msg.weekday = 5;\n        break;\n    case \"Sat\":\n        msg.weekday = 6;\n        break;\n    case \"Sun\":\n        msg.weekday = 7;\n        break;\n}\nmsg.minutes =parseInt(msg.myhour)*60 + parseInt(msg.myminute);\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":480,"wires":[["a999168b.7b4a68","fb077a91.061b4","62d64442.f28ecc","a8899f64.0fd908","224f2352.c7a6ac","dee04741.1b807","8a4314be.11ad"]]},{"id":"a999168b.7b4a68","type":"function","z":"49caefca.99d708","name":"Decision Block Orto","func":"if (global.get(\"irrigazioneOrtoMode\") != \"MANUAL_ON\"){\n    var key1 = \"4_1_\" + msg.weekday;\n    var key2 = \"4_2_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneOrtoStart1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneOrtoStop1\"))\n        )\n        {\n            nodeText = \"ACCESO - F1 - \" + global.get(\"irrigazioneOrtoStart1\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneOrtoStop1\");\n        }\n        \n    if  (\n            (buttonsMap[key2] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneOrtoStart2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneOrtoStop2\"))\n        )\n        {\n            nodeText = \"ACCESO - F2 - \" + global.get(\"irrigazioneOrtoStart2\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneOrtoStop2\");\n        }\n    if (nodeText.includes(\"ACCESO\"))\n    {\n        node.status({fill:\"blue\",shape:\"dot\",text:nodeText});\n        if \n        (global.get(\"irrigazioneOrtoStatus\") === false)\n            {\n            msg.payload = \"ON\";\n            return msg;\n        }\n    }\n    else\n    {\n        node.status({fill:\"blue\",shape:\"ring\",text:\"SPENTO\"});\n        if (global.get(\"irrigazioneOrtoStatus\") === true)\n            {\n                msg.payload = \"OFF\"\n                return msg;\n            }\n    }\n    \n}\n\n\n","outputs":1,"noerr":0,"x":780,"y":180,"wires":[["51706928.8ad558"]]},{"id":"51706928.8ad558","type":"switch","z":"49caefca.99d708","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":950,"y":180,"wires":[["ea136d57.c4a308"],["2d4dd2a8.d77626"]]},{"id":"ea136d57.c4a308","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_ON","rules":[{"t":"set","p":"irrigazioneOrtoMode","pt":"global","to":"TIMER_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":160,"wires":[["1224d7b4.eb11b"]]},{"id":"2d4dd2a8.d77626","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_OFF","rules":[{"t":"set","p":"irrigazioneOrtoMode","pt":"global","to":"TIMER_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":200,"wires":[["1224d7b4.eb11b"]]},{"id":"ebe840aa.12ccc","type":"simpletime","z":"49caefca.99d708","name":"","x":250,"y":480,"wires":[["30dba9bf.3dcdce","599cd7cc.bfecd"]]},{"id":"1224d7b4.eb11b","type":"trigger","z":"49caefca.99d708","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1420,"y":180,"wires":[["1e77e99d.cac89e"]]},{"id":"fb077a91.061b4","type":"function","z":"49caefca.99d708","name":"Decision Block Zona1","func":"if (global.get(\"irrigazioneZona1Mode\") != \"MANUAL_ON\"){\n    var key1 = \"1_1_\" + msg.weekday;\n    var key2 = \"1_2_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona1Start1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona1Stop1\"))\n        )\n        {\n            nodeText = \"ACCESO - F1 - \" + global.get(\"irrigazioneZona1Start1\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneZona1Stop1\");\n        }\n        \n    if  (\n            (buttonsMap[key2] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona1Start2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona1Stop2\"))\n        )\n        {\n            nodeText = \"ACCESO - F2 - \" + global.get(\"irrigazioneZona1Start2\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneZona1Stop2\");\n        }\n    if (nodeText.includes(\"ACCESO\"))\n    {\n        node.status({fill:\"blue\",shape:\"dot\",text:nodeText});\n        if \n        (global.get(\"irrigazioneZona1Status\") === false)\n            {\n            msg.payload = \"ON\";\n            return msg;\n        }\n    }\n    else\n    {\n        node.status({fill:\"blue\",shape:\"ring\",text:\"SPENTO\"});\n        if (global.get(\"irrigazioneZona1Status\") === true)\n            {\n                msg.payload = \"OFF\"\n                return msg;\n            }\n    }\n    \n}\n\n\n","outputs":1,"noerr":0,"x":780,"y":480,"wires":[["3f6213c1.dcbd94"]]},{"id":"3f6213c1.dcbd94","type":"switch","z":"49caefca.99d708","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":950,"y":480,"wires":[["7ac84b01.3ad964"],["5b77b52f.5e40fc"]]},{"id":"7ac84b01.3ad964","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_ON","rules":[{"t":"set","p":"irrigazioneZona1Mode","pt":"global","to":"TIMER_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":460,"wires":[["617bc92f.8aa9"]]},{"id":"5b77b52f.5e40fc","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_OFF","rules":[{"t":"set","p":"irrigazioneZona1Mode","pt":"global","to":"TIMER_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":500,"wires":[["617bc92f.8aa9"]]},{"id":"617bc92f.8aa9","type":"trigger","z":"49caefca.99d708","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1420,"y":480,"wires":[["2be0138e.351b64"]]},{"id":"2be0138e.351b64","type":"s7 out","z":"49caefca.99d708","endpoint":"ba13c465.38463","variable":"irrigazione_zona_1","name":"irrigazione zona 1","x":1630,"y":480,"wires":[]},{"id":"62d64442.f28ecc","type":"function","z":"49caefca.99d708","name":"Decision Block Zona2","func":"if (global.get(\"irrigazioneZona2Mode\") != \"MANUAL_ON\"){\n    var key1 = \"2_1_\" + msg.weekday;\n    var key2 = \"2_2_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona2Start1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona2Stop1\"))\n        )\n        {\n            nodeText = \"ACCESO - F1 - \" + global.get(\"irrigazioneZona2Start1\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneZona2Stop1\");\n        }\n        \n    if  (\n            (buttonsMap[key2] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona2Start2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona2Stop2\"))\n        )\n        {\n            nodeText = \"ACCESO - F2 - \" + global.get(\"irrigazioneZona2Start2\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneZona2Stop2\");\n        }\n    if (nodeText.includes(\"ACCESO\"))\n    {\n        node.status({fill:\"blue\",shape:\"dot\",text:nodeText});\n        if \n        (global.get(\"irrigazioneZona2Status\") === false)\n            {\n            msg.payload = \"ON\";\n            return msg;\n        }\n    }\n    else\n    {\n        node.status({fill:\"blue\",shape:\"ring\",text:\"SPENTO\"});\n        if (global.get(\"irrigazioneZona2Status\") === true)\n            {\n                msg.payload = \"OFF\"\n                return msg;\n            }\n    }\n    \n}\n\n\n","outputs":1,"noerr":0,"x":780,"y":800,"wires":[["30cb7328.691b44"]]},{"id":"30cb7328.691b44","type":"switch","z":"49caefca.99d708","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":950,"y":800,"wires":[["ecdb2677.b29938"],["4e719916.45251"]]},{"id":"ecdb2677.b29938","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_ON","rules":[{"t":"set","p":"irrigazioneZona2Mode","pt":"global","to":"TIMER_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":780,"wires":[["a5ec8064.4d5f9"]]},{"id":"4e719916.45251","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_OFF","rules":[{"t":"set","p":"irrigazioneZona2Mode","pt":"global","to":"TIMER_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":820,"wires":[["a5ec8064.4d5f9"]]},{"id":"a5ec8064.4d5f9","type":"trigger","z":"49caefca.99d708","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1420,"y":800,"wires":[["7e574d27.06d88c"]]},{"id":"7e574d27.06d88c","type":"s7 out","z":"49caefca.99d708","endpoint":"ba13c465.38463","variable":"irrigazione_zona_2","name":"irrigazione zona 2","x":1630,"y":800,"wires":[]},{"id":"a8899f64.0fd908","type":"function","z":"49caefca.99d708","name":"Decision Block Zona3","func":"if (global.get(\"irrigazioneZona3Mode\") != \"MANUAL_ON\"){\n    var key1 = \"3_1_\" + msg.weekday;\n    var key2 = \"3_2_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona3Start1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona3Stop1\"))\n        )\n        {\n            nodeText = \"ACCESO - F1 - \" + global.get(\"irrigazioneZona3Start1\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneZona3Stop1\");\n        }\n        \n    if  (\n            (buttonsMap[key2] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona3Start2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona3Stop2\"))\n        )\n        {\n            nodeText = \"ACCESO - F2 - \" + global.get(\"irrigazioneZona3Start2\") + \" < \" + msg.minutes + \" < \" + global.get(\"irrigazioneZona3Stop2\");\n        }\n    if (nodeText.includes(\"ACCESO\"))\n    {\n        node.status({fill:\"blue\",shape:\"dot\",text:nodeText});\n        if \n        (global.get(\"irrigazioneZona3Status\") === false)\n            {\n            msg.payload = \"ON\";\n            return msg;\n        }\n    }\n    else\n    {\n        node.status({fill:\"blue\",shape:\"ring\",text:\"SPENTO\"});\n        if (global.get(\"irrigazioneZona3Status\") === true)\n            {\n                msg.payload = \"OFF\"\n                return msg;\n            }\n    }\n    \n}\n\n\n","outputs":1,"noerr":0,"x":780,"y":1140,"wires":[["b55d2445.c50a3"]]},{"id":"b55d2445.c50a3","type":"switch","z":"49caefca.99d708","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":950,"y":1140,"wires":[["dfa6c42e.c4541"],["46a41648.0fc0a8"]]},{"id":"dfa6c42e.c4541","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_ON","rules":[{"t":"set","p":"irrigazioneZona3Mode","pt":"global","to":"TIMER_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":1120,"wires":[["c1041caf.6bd268"]]},{"id":"46a41648.0fc0a8","type":"change","z":"49caefca.99d708","name":"Mode to TIMER_OFF","rules":[{"t":"set","p":"irrigazioneZona3Mode","pt":"global","to":"TIMER_OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":1160,"wires":[["c1041caf.6bd268"]]},{"id":"c1041caf.6bd268","type":"trigger","z":"49caefca.99d708","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"150","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1420,"y":1140,"wires":[["d6a670e4.11ac28"]]},{"id":"d6a670e4.11ac28","type":"s7 out","z":"49caefca.99d708","endpoint":"ba13c465.38463","variable":"irrigazione_zona_3","name":"Irrigazione zona 3","x":1630,"y":1140,"wires":[]},{"id":"3e9d5410.d9cccc","type":"function","z":"49caefca.99d708","name":"Create Log Entry","func":"var currentTime = new Date();\nvar currentTimeMs = currentTime.getTime();\nvar currentTimeReadable = currentTime.toLocaleTimeString();\nvar currentTimeSeconds = Math.floor(currentTimeMs/1000);\n\nswitch (msg.topic){\n    case \"pulsante\":\n        messageSource = \"pulsante_dashboard_orto\";\n        break;\n    default:\n        messageSource = \"logo_irrigazione_Q04_\" + msg.payload;\n        break;\n}\n\n\nvar newline = \"\";\n\n// timestamp leggibile dell'evento corrente\nnewline += currentTime + \";\";\n// timestamp in millisecondi epoch\nnewline += currentTimeMs + \";\";\n// tipo evento\nnewline += messageSource + \";\";\n\n\nmsg.payload = newline;\nnode.status({fill:\"blue\",shape:\"dot\",text:currentTime.toString()});\n\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":80,"wires":[["dfb3e062.f47ad8"]]},{"id":"dfb3e062.f47ad8","type":"file","z":"49caefca.99d708","name":"Write to logfile","filename":"/home/pi/logo_irrigazione.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":1620,"y":80,"wires":[[]]},{"id":"a8105730.edf98","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneZona1Mode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":1580,"wires":[["99365606.ca0ab"]]},{"id":"9b6a34ed.274db","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneOrtoMode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":840,"wires":[["c9afe06e.77a81"]]},{"id":"9b6610be.f4a358","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneZona2Mode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":2140,"wires":[["f9c3e80e.07bcf"]]},{"id":"8216b7ea.dc1bc8","type":"change","z":"e45dc9d3.dd3ac","name":"Mode to MANUAL_ON","rules":[{"t":"set","p":"irrigazioneZona3Mode","pt":"global","to":"MANUAL_ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":2700,"wires":[["cb21170f.90d338"]]},{"id":"848f939f.d35598","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":2760,"wires":[["167115f1.d8022a"]]},{"id":"167115f1.d8022a","type":"function","z":"e45dc9d3.dd3ac","name":"Counter Label","func":"\n\n\nif (global.get(\"irrigazioneZona3Status\") === false)\n{\n    global.set(\"irrigazioneZona3CounterStartedAt\", 0);\n    msg.buttonlabel = \"Zona 3\";\n    msg.background = \"#0094ce\";\n}\nelse\n{\n    if (global.get(\"irrigazioneZona3CounterStartedAt\") === 0){\n        global.set(\"irrigazioneZona3CounterStartedAt\", msg.payload);\n    }\n    \n    var seconds = Math.floor((msg.payload - global.get(\"irrigazioneZona3CounterStartedAt\")) / 1000);\n    var secondString = seconds % 60;\n    if (secondString < 10){\n        secondString = \"0\" + secondString.toString();\n    }\n    else\n    {\n        secondString = secondString.toString();\n    }\n    var minuteString = Math.floor(seconds/60);\n    if (minuteString < 10){\n        minuteString = \"0\" + minuteString.toString();\n    }\n    else\n    {\n        minuteString = minuteString.toString;\n    }\n    \n    \n    msg.buttonlabel = \"Zona 3 - \" + minuteString + \":\" + secondString;\n    msg.background = \"#00FF00\";\n    buttonString = seconds;\n    buttonShape = \"dot\";\n    buttonFill = \"green\";\n    node.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":120,"y":2720,"wires":[["11a92472.c53c8c"]]},{"id":"e1783fc9.239d98","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":2240,"wires":[["d2ad0db0.f3d978"]]},{"id":"d2ad0db0.f3d978","type":"function","z":"e45dc9d3.dd3ac","name":"Counter Label","func":"\n\n\nif (global.get(\"irrigazioneZona2Status\") === false)\n{\n    global.set(\"irrigazioneZona2CounterStartedAt\", 0);\n    msg.buttonlabel = \"Zona 2\";\n    msg.background = \"#0094ce\";\n}\nelse\n{\n    if (global.get(\"irrigazioneZona2CounterStartedAt\") === 0){\n        global.set(\"irrigazioneZona2CounterStartedAt\", msg.payload);\n    }\n    \n    var seconds = Math.floor((msg.payload - global.get(\"irrigazioneZona2CounterStartedAt\")) / 1000);\n    var secondString = seconds % 60;\n    if (secondString < 10){\n        secondString = \"0\" + secondString.toString();\n    }\n    else\n    {\n        secondString = secondString.toString();\n    }\n    var minuteString = Math.floor(seconds/60);\n    if (minuteString < 10){\n        minuteString = \"0\" + minuteString.toString();\n    }\n    else\n    {\n        minuteString = minuteString.toString;\n    }\n    \n    \n    msg.buttonlabel = \"Zona 2 - \" + minuteString + \":\" + secondString;\n    msg.background = \"#00FF00\";\n    buttonString = seconds;\n    buttonShape = \"dot\";\n    buttonFill = \"green\";\n    node.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":120,"y":2200,"wires":[["5e95c597.124c34"]]},{"id":"e5d5bd68.cbfc6","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":150,"y":1660,"wires":[["6ad7b4ea.1dc15c"]]},{"id":"6ad7b4ea.1dc15c","type":"function","z":"e45dc9d3.dd3ac","name":"Counter Label","func":"\n\n\nif (global.get(\"irrigazioneZona1Status\") === false)\n{\n    global.set(\"irrigazioneZona1CounterStartedAt\", 0);\n    msg.buttonlabel = \"Zona 1\";\n    msg.background = \"#0094ce\";\n}\nelse\n{\n    if (global.get(\"irrigazioneZona1CounterStartedAt\") === 0){\n        global.set(\"irrigazioneZona1CounterStartedAt\", msg.payload);\n    }\n    \n    var seconds = Math.floor((msg.payload - global.get(\"irrigazioneZona1CounterStartedAt\")) / 1000);\n    var secondString = seconds % 60;\n    if (secondString < 10){\n        secondString = \"0\" + secondString.toString();\n    }\n    else\n    {\n        secondString = secondString.toString();\n    }\n    var minuteString = Math.floor(seconds/60);\n    if (minuteString < 10){\n        minuteString = \"0\" + minuteString.toString();\n    }\n    else\n    {\n        minuteString = minuteString.toString;\n    }\n    \n    \n    msg.buttonlabel = \"Zona 1 - \" + minuteString + \":\" + secondString;\n    msg.background = \"#00FF00\";\n    buttonString = seconds;\n    buttonShape = \"dot\";\n    buttonFill = \"green\";\n    node.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":160,"y":1620,"wires":[["cf13b826.a477d"]]},{"id":"f9c8fffa.1a773","type":"inject","z":"e45dc9d3.dd3ac","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":880,"wires":[["195900c6.bb4187"]]},{"id":"195900c6.bb4187","type":"function","z":"e45dc9d3.dd3ac","name":"Counter Label","func":"\n\n\nif (global.get(\"irrigazioneOrtoStatus\") === false)\n{\n    global.set(\"irrigazioneOrtoCounterStartedAt\", 0);\n    msg.buttonlabel = \"Orto\";\n    msg.background = \"#0094ce\";\n}\nelse\n{\n    if (global.get(\"irrigazioneOrtoCounterStartedAt\") === 0){\n        global.set(\"irrigazioneOrtoCounterStartedAt\", msg.payload);\n    }\n    \n    var seconds = Math.floor((msg.payload - global.get(\"irrigazioneOrtoCounterStartedAt\")) / 1000);\n    var secondString = seconds % 60;\n    if (secondString < 10){\n        secondString = \"0\" + secondString.toString();\n    }\n    else\n    {\n        secondString = secondString.toString();\n    }\n    var minuteString = Math.floor(seconds/60);\n    if (minuteString < 10){\n        minuteString = \"0\" + minuteString.toString();\n    }\n    else\n    {\n        minuteString = minuteString.toString;\n    }\n    \n    \n    msg.buttonlabel = \"Orto - \" + minuteString + \":\" + secondString;\n    msg.background = \"#00FF00\";\n    buttonString = seconds;\n    buttonShape = \"dot\";\n    buttonFill = \"green\";\n    node.status({fill:buttonFill,shape:buttonShape,text:buttonString});\n\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":140,"y":840,"wires":[["a0a400b1.234f7"]]},{"id":"11a92472.c53c8c","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneZona3Mode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":140,"y":2680,"wires":[["ee86846.91b7ff8"]]},{"id":"5e95c597.124c34","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneZona2Mode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":140,"y":2160,"wires":[["e480ae82.453ea"]]},{"id":"cf13b826.a477d","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneZona1Mode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":180,"y":1580,"wires":[["fc46749c.526818"]]},{"id":"a0a400b1.234f7","type":"switch","z":"e45dc9d3.dd3ac","name":"Only If not TIMER_ON","property":"irrigazioneOrtoMode","propertyType":"global","rules":[{"t":"neq","v":"TIMER_ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":160,"y":800,"wires":[["de4051d7.613ba"]]},{"id":"a71f4eca.19209","type":"ui_button","z":"49caefca.99d708","name":"Running_zona2_fascia1","group":"3d2d4886.4965b","order":3,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1370,"y":920,"wires":[[]]},{"id":"1ea38ff2.98c5b8","type":"ui_button","z":"49caefca.99d708","name":"Running_zona2_fascia2","group":"3d2d4886.4965b","order":13,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1370,"y":980,"wires":[[]]},{"id":"bb51217b.39ae78","type":"ui_button","z":"49caefca.99d708","name":"Running_zona1_fascia1","group":"4030d99d.8cb298","order":3,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1370,"y":580,"wires":[[]]},{"id":"940f8da6.fab1f","type":"ui_button","z":"49caefca.99d708","name":"Running_zona1_fascia2","group":"4030d99d.8cb298","order":13,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1370,"y":640,"wires":[[]]},{"id":"14c1d20e.2688e6","type":"ui_button","z":"49caefca.99d708","name":"Running_orto_fascia1","group":"d1f1e371.844e68","order":3,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1360,"y":300,"wires":[[]]},{"id":"b056e9ec.72abd8","type":"ui_button","z":"49caefca.99d708","name":"Running_orto_fascia2","group":"d1f1e371.844e68","order":13,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1360,"y":360,"wires":[[]]},{"id":"906ad4f7.5869f8","type":"ui_button","z":"49caefca.99d708","name":"Running_zona3_fascia1","group":"5a4ba258.d8a4a4","order":3,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1370,"y":1260,"wires":[[]]},{"id":"c6d5bf12.b16168","type":"ui_button","z":"49caefca.99d708","name":"Running_zona3_fascia2","group":"5a4ba258.d8a4a4","order":13,"width":"3","height":"1","passthru":false,"label":"{{msg.buttonlabel}}","color":"","bgcolor":"{{msg.background}}","icon":"","payload":"","payloadType":"str","topic":"","x":1370,"y":1320,"wires":[[]]},{"id":"ab8c9b7b.00ccb8","type":"function","z":"49caefca.99d708","name":"Decision Block Zona3/1","func":"if ((global.get(\"irrigazioneZona3Status\") === true) && (global.get(\"irrigazioneZona3Mode\") === \"TIMER_ON\")){\n    var key1 = \"3_1_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona3Start1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona3Stop1\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneZona3CounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 1 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 1\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Zona 3\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 1\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":1260,"wires":[["906ad4f7.5869f8"]]},{"id":"599cd7cc.bfecd","type":"function","z":"49caefca.99d708","name":"Extract total minutes and weekday","func":"msg.minutes =parseInt(msg.myhour)*60 + parseInt(msg.myminute);\nswitch (msg.myday){\n    case \"Mon\":\n        msg.weekday = 1;\n        break;\n    case \"Tue\":\n        msg.weekday = 2;\n        break;\n    case \"Wed\":\n        msg.weekday = 3;\n        break;\n    case \"Thu\":\n        msg.weekday = 4;\n        break;\n    case \"Fri\":\n        msg.weekday = 5;\n        break;\n    case \"Sat\":\n        msg.weekday = 6;\n        break;\n    case \"Sun\":\n        msg.weekday = 7;\n        break;\n}\nmsg.irrigazioneZona3CounterStartedAt = global.get(\"irrigazioneZona3CounterStartedAt\");\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":1300,"wires":[["ab8c9b7b.00ccb8","6975b2d6.3d6034"]]},{"id":"6975b2d6.3d6034","type":"function","z":"49caefca.99d708","name":"Decision Block Zona3/2","func":"if ((global.get(\"irrigazioneZona3Status\") === true) && (global.get(\"irrigazioneZona3Mode\") === \"TIMER_ON\")){\n    var key1 = \"3_2_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona3Start2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona3Stop2\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneZona3CounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 2 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else \n        {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 2\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Zona 3\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 2\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":1320,"wires":[["c6d5bf12.b16168"]]},{"id":"4be072b.538190c","type":"function","z":"49caefca.99d708","name":"Decision Block Zona2/1","func":"if ((global.get(\"irrigazioneZona2Status\") === true) && (global.get(\"irrigazioneZona2Mode\") === \"TIMER_ON\")){\n    var key1 = \"2_1_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona2Start1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona2Stop1\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneZona2CounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 1 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 1\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Zona 2\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 1\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":920,"wires":[["a71f4eca.19209"]]},{"id":"224f2352.c7a6ac","type":"function","z":"49caefca.99d708","name":"Extract total minutes and weekday","func":"msg.minutes =parseInt(msg.myhour)*60 + parseInt(msg.myminute);\nswitch (msg.myday){\n    case \"Mon\":\n        msg.weekday = 1;\n        break;\n    case \"Tue\":\n        msg.weekday = 2;\n        break;\n    case \"Wed\":\n        msg.weekday = 3;\n        break;\n    case \"Thu\":\n        msg.weekday = 4;\n        break;\n    case \"Fri\":\n        msg.weekday = 5;\n        break;\n    case \"Sat\":\n        msg.weekday = 6;\n        break;\n    case \"Sun\":\n        msg.weekday = 7;\n        break;\n}\nmsg.irrigazioneZona3CounterStartedAt = global.get(\"irrigazioneZona2CounterStartedAt\");\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":940,"wires":[["4be072b.538190c","c77726d2.6b7ba"]]},{"id":"c77726d2.6b7ba","type":"function","z":"49caefca.99d708","name":"Decision Block Zona2/1","func":"if ((global.get(\"irrigazioneZona2Status\") === true) && (global.get(\"irrigazioneZona2Mode\") === \"TIMER_ON\")){\n    var key1 = \"2_2_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona2Start2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona2Stop2\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneZona2CounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 2 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else \n        {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 2\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Zona 2\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 2\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":980,"wires":[["1ea38ff2.98c5b8"]]},{"id":"d5100b4.8d9f6f8","type":"function","z":"49caefca.99d708","name":"Decision Block Zona1/1","func":"if ((global.get(\"irrigazioneZona1Status\") === true) && (global.get(\"irrigazioneZona1Mode\") === \"TIMER_ON\")){\n    var key1 = \"1_1_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona1Start1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona1Stop1\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneZona1CounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 1 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 1\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Zona 1\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 1\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":580,"wires":[["bb51217b.39ae78"]]},{"id":"dee04741.1b807","type":"function","z":"49caefca.99d708","name":"Extract total minutes and weekday","func":"msg.minutes =parseInt(msg.myhour)*60 + parseInt(msg.myminute);\nswitch (msg.myday){\n    case \"Mon\":\n        msg.weekday = 1;\n        break;\n    case \"Tue\":\n        msg.weekday = 2;\n        break;\n    case \"Wed\":\n        msg.weekday = 3;\n        break;\n    case \"Thu\":\n        msg.weekday = 4;\n        break;\n    case \"Fri\":\n        msg.weekday = 5;\n        break;\n    case \"Sat\":\n        msg.weekday = 6;\n        break;\n    case \"Sun\":\n        msg.weekday = 7;\n        break;\n}\nmsg.irrigazioneZona3CounterStartedAt = global.get(\"irrigazioneZona1CounterStartedAt\");\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":600,"wires":[["d5100b4.8d9f6f8","b8d740e8.c3037"]]},{"id":"b8d740e8.c3037","type":"function","z":"49caefca.99d708","name":"Decision Block Zona1/2","func":"if ((global.get(\"irrigazioneZona1Status\") === true) && (global.get(\"irrigazioneZona1Mode\") === \"TIMER_ON\")){\n    var key1 = \"1_1_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneZona1Start2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneZona1Stop2\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneZona1CounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 2 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else \n        {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 2\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Zona 1\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 2\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":640,"wires":[["940f8da6.fab1f"]]},{"id":"36824d70.aa186a","type":"function","z":"49caefca.99d708","name":"Decision Block Orto/1","func":"if ((global.get(\"irrigazioneOrtoStatus\") === true) && (global.get(\"irrigazioneOrtoMode\") === \"TIMER_ON\")){\n    var key1 = \"4_1_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneOrtoStart1\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneOrtoStop1\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneOrtoCounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 1 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 1\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Orto\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 1\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":300,"wires":[["14c1d20e.2688e6"]]},{"id":"8a4314be.11ad","type":"function","z":"49caefca.99d708","name":"Extract total minutes and weekday","func":"msg.minutes =parseInt(msg.myhour)*60 + parseInt(msg.myminute);\nswitch (msg.myday){\n    case \"Mon\":\n        msg.weekday = 1;\n        break;\n    case \"Tue\":\n        msg.weekday = 2;\n        break;\n    case \"Wed\":\n        msg.weekday = 3;\n        break;\n    case \"Thu\":\n        msg.weekday = 4;\n        break;\n    case \"Fri\":\n        msg.weekday = 5;\n        break;\n    case \"Sat\":\n        msg.weekday = 6;\n        break;\n    case \"Sun\":\n        msg.weekday = 7;\n        break;\n}\nmsg.irrigazioneZona3CounterStartedAt = global.get(\"irrigazioneOrtoCounterStartedAt\");\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":320,"wires":[["36824d70.aa186a","fcf27365.d086d"]]},{"id":"fcf27365.d086d","type":"function","z":"49caefca.99d708","name":"Decision Block Orto/2","func":"if ((global.get(\"irrigazioneOrtoStatus\") === true) && (global.get(\"irrigazioneOrtoMode\") === \"TIMER_ON\")){\n    var key1 = \"4_2_\" + msg.weekday;\n    var buttonsMap = global.get(\"buttonsMap\");\n    var nodeText = \"\";\n\n    if (\n            (buttonsMap[key1] === true) \n            &&\n            (msg.minutes >= global.get(\"irrigazioneOrtoStart2\")) \n            &&\n            (msg.minutes < global.get(\"irrigazioneOrtoStop2\"))\n        )\n        {\n            msg.totalseconds = Math.floor((msg.payload - msg.irrigazioneOrtoCounterStartedAt) / 1000);\n            if (msg.totalseconds > 86400)\n            {\n                msg.totalseconds = 0;\n            }\n            msg.secondString = msg.totalseconds % 60;\n            if (msg.secondString < 10){\n                msg.secondString = \"0\" + msg.secondString.toString();\n            }\n            else\n            {\n                msg.secondString = msg.secondString.toString();\n            }\n            msg.minuteString = Math.floor(msg.totalseconds/60);\n            if (msg.minuteString < 10){\n                msg.minuteString = \"0\" + msg.minuteString.toString();\n            }\n            else\n            {\n                msg.minuteString = msg.minuteString.toString();\n            }\n            msg.counterPast = \"Fascia 2 - \" + msg.minuteString + \":\" + msg.secondString;\n            \n            node.status({fill:\"blue\",shape:\"dot\",text:msg.counterPast});\n            msg.buttonlabel = msg.counterPast;\n            msg.background = \"#00FF00\";\n        }\n        else \n        {\n            msg.background = \"#0094ce\";\n            msg.buttonlabel = \"Fascia 2\";\n        }\n\n}\nelse\n{\n    node.status({fill:\"blue\",shape:\"ring\",text:\"Orto\"});\n    msg.background = \"#0094ce\";\n    msg.buttonlabel = \"Fascia 2\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":360,"wires":[["b056e9ec.72abd8"]]},{"id":"1274d3a3.92714c","type":"ui_ui_control","z":"8145ac64.048b7","name":"","x":100,"y":500,"wires":[["e6c8bba9.01bd9"]]},{"id":"41d578fa.948ca8","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona1Start1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":80,"wires":[["b71fb087.ebe08"]]},{"id":"5b7f9ee6.d20a3","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona1Stop1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":120,"wires":[["c9bae894.66d9f8"]]},{"id":"9c0547f7.9f2eb8","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona1Start2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":160,"wires":[["166c3fa5.a0618"]]},{"id":"603da73.d65e8d8","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona1Stop2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":200,"wires":[["b3c0ca72.12b8b"]]},{"id":"6709042d.d824a4","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona2Start1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":240,"wires":[["37bdd284.d94dfe"]]},{"id":"1dc82314.54a015","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona2Stop1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":280,"wires":[["dde8d893.0c6ac8"]]},{"id":"9f6e580f.cf4628","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona2Stop2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":360,"wires":[["ed6fedff.29e888"]]},{"id":"fb9bb778.638e98","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona2Start2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":320,"wires":[["d96f94c6.b49308"]]},{"id":"619195a2.e3be44","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona3Stop1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":440,"wires":[["20f4aec7.b6307a"]]},{"id":"27dc8a59.b23aee","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona3Start1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":400,"wires":[["1b343cec.4fa523"]]},{"id":"23b0a1f9.7e02f6","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona3Start2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":480,"wires":[["d446da37.f27d4"]]},{"id":"8512be6.69b8a4","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneZona3Stop2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":520,"wires":[["4f9bd087.47f5d8"]]},{"id":"e5374871.c8dcc8","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneOrtoStop1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":600,"wires":[["5375f278.4765cc"]]},{"id":"db315e98.d8286","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneOrtoStart1\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":560,"wires":[["e4bce99.4a51418"]]},{"id":"ac8368f2.f5cb38","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneOrtoStart2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":640,"wires":[["90ade384.e0648"]]},{"id":"1a565d29.26cd8b","type":"function","z":"8145ac64.048b7","name":"read","func":"var time = global.get(\"irrigazioneOrtoStop2\");\nvar hour = Math.floor(time/60).toString();\nif (hour.length < 2)\n{\n    hour = \"0\" + hour;\n}\nvar minute = (time%60).toString();\nif (minute.length < 2)\n{\n    minute = \"0\" + minute;\n}\nmsg.payload = hour + \":\" + minute;\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":680,"wires":[["28d09a3.ad5cbe6"]]},{"id":"e6c8bba9.01bd9","type":"switch","z":"8145ac64.048b7","name":"","property":"name","propertyType":"msg","rules":[{"t":"eq","v":"Irrigazione","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":210,"y":380,"wires":[["41d578fa.948ca8","5b7f9ee6.d20a3","9c0547f7.9f2eb8","603da73.d65e8d8","6709042d.d824a4","1dc82314.54a015","fb9bb778.638e98","9f6e580f.cf4628","27dc8a59.b23aee","619195a2.e3be44","23b0a1f9.7e02f6","8512be6.69b8a4","db315e98.d8286","e5374871.c8dcc8","ac8368f2.f5cb38","1a565d29.26cd8b"],[]]},{"id":"2675cd48.d46e22","type":"ui_ui_control","z":"8145ac64.048b7","name":"","x":100,"y":1100,"wires":[["d76e2677.c49a18"]]},{"id":"d76e2677.c49a18","type":"switch","z":"8145ac64.048b7","name":"If Irrigazione","property":"name","propertyType":"msg","rules":[{"t":"eq","v":"Irrigazione","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":110,"y":1160,"wires":[["97fd45b7.c281e8"],[]]},{"id":"4e42bb3a.90ca5c","type":"inject","z":"8145ac64.048b7","name":"","topic":"","payload":"{\"background\":\"#FFA500\"}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":874,"y":1389,"wires":[["7f667b50.4df934"]]},{"id":"9bdd57da.25102","type":"debug","z":"8145ac64.048b7","name":"COLOBUTTON","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":945,"y":1443,"wires":[]},{"id":"6a1514b0.211234","type":"debug","z":"8145ac64.048b7","name":"FASCIA","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":860,"y":1600,"wires":[]},{"id":"fc01dd38.610158","type":"debug","z":"8145ac64.048b7","name":"POST-COLOR","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":608,"y":1444,"wires":[]},{"id":"3253b44b.3ecce4","type":"debug","z":"8145ac64.048b7","name":"ZONA-3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":880,"y":1740,"wires":[]},{"id":"910ffa78.ca86e","type":"debug","z":"8145ac64.048b7","name":"ZONA-OTHERWISE","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":620,"y":1800,"wires":[]},{"id":"a71cd640.08066","type":"function","z":"8145ac64.048b7","name":"Zone Switch","func":"switch (msg.payload.zona){\n    case 1:\n        return [msg, null, null, null, null];\n    case 2:\n        return [null, msg, null, null, null];\n    case 3:\n        return [null, null, msg, null, null];\n    case 4:\n        return [null, null, null, msg, null];\n    default:\n        return [null, null, null, null, msg];\n}","outputs":5,"noerr":0,"x":236.16665649414062,"y":1721.1666259765625,"wires":[[],[],[],[],[]]},{"id":"7f46de98.fdde6","type":"alexa-home","z":"d39b9be8.95c69","conf":"16329d6f.9c512b","device":"80173","acknoledge":true,"name":"sala uno","topic":"","x":1020,"y":200,"wires":[["59eff5e3.6a6074","6735c82d.0a47f"]]},{"id":"59eff5e3.6a6074","type":"debug","z":"d39b9be8.95c69","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1190,"y":100,"wires":[]},{"id":"613de193.c910b","type":"alexa-home","z":"d39b9be8.95c69","conf":"16329d6f.9c512b","device":"80174","acknoledge":true,"name":"sala due","topic":"","x":1040,"y":580,"wires":[["38021d1c.1f7b0a","35cb54ef.5a9414"]]},{"id":"38021d1c.1f7b0a","type":"debug","z":"d39b9be8.95c69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1210,"y":500,"wires":[]},{"id":"d88313fe.0e6fe8","type":"alexa-home","z":"d39b9be8.95c69","conf":"16329d6f.9c512b","device":"80175","acknoledge":true,"name":"sala tre","topic":"","x":1030,"y":880,"wires":[["c0ef35e7.c7cb98","9607048f.93ec1"]]},{"id":"c0ef35e7.c7cb98","type":"debug","z":"d39b9be8.95c69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1230,"y":820,"wires":[]},{"id":"d46bdfec.921ae","type":"alexa-home","z":"d39b9be8.95c69","conf":"16329d6f.9c512b","device":"80176","acknoledge":true,"name":"sala quattro","topic":"","x":1150,"y":1260,"wires":[["f4b25d5c.1d351","fa752dbf.774ef"]]},{"id":"f4b25d5c.1d351","type":"debug","z":"d39b9be8.95c69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1410,"y":1260,"wires":[]},{"id":"6735c82d.0a47f","type":"switch","z":"d39b9be8.95c69","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1210,"y":200,"wires":[["3d4c65d3.a83d7a"],["acf62283.879da"]]},{"id":"35cb54ef.5a9414","type":"switch","z":"d39b9be8.95c69","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1270,"y":580,"wires":[["55bb4db0.785544"],["68bacf07.09ba5"]]},{"id":"9607048f.93ec1","type":"switch","z":"d39b9be8.95c69","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1250,"y":900,"wires":[["5c01844f.671c74"],["64134988.29f598"]]},{"id":"fa752dbf.774ef","type":"switch","z":"d39b9be8.95c69","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1310,"y":1320,"wires":[["2f9f82c9.4a7286"],["73f50ba.7b2bbf4"]]},{"id":"52d731fb.ee0c18","type":"alexa-home","z":"30164f4b.56c61","conf":"16329d6f.9c512b","device":"80320","acknoledge":true,"name":"casa","topic":"","x":70,"y":360,"wires":[["aad51007.c0a1f8"]]},{"id":"aad51007.c0a1f8","type":"switch","z":"30164f4b.56c61","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":210,"y":380,"wires":[["e81c48a6.1b77d8","7c4027cb.25ba2"],["2445e4a8.b0f22c","7c4027cb.25ba2"]]},{"id":"7c4027cb.25ba2","type":"alexa-home-resp","z":"30164f4b.56c61","x":180,"y":160,"wires":[]},{"id":"684e4fc2.6491c8","type":"debug","z":"d39b9be8.95c69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":1580,"wires":[]},{"id":"b56fdda3.dfe4b","type":"function","z":"d39b9be8.95c69","name":"","func":"switch (msg.payload){\n    case \"SHORT\":\n        node.status({fill:\"blue\",shape:\"dot\",text:\"SHORT\"});\n        break;\n    case \"MEDIUM\":\n        node.status({fill:\"green\",shape:\"dot\",text:\"MEDIUM\"});\n        break;\n    case \"LONG\":\n        node.status({fill:\"yellow\",shape:\"dot\",text:\"LONG\"});\n        break;\n}\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1580,"wires":[["684e4fc2.6491c8"]]},{"id":"f509f2d7.73d448","type":"debug","z":"d39b9be8.95c69","name":"IF-GLOBAL-ON","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1040,"y":1500,"wires":[]},{"id":"177fb8cf.4f3657","type":"debug","z":"d39b9be8.95c69","name":"IF-GLOBAL-OFF","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1050,"y":1540,"wires":[]},{"id":"615079f4.e9d9f","type":"debug","z":"d39b9be8.95c69","name":"SIGNAL-ON","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":890,"y":1300,"wires":[]},{"id":"b0590cd0.2a1aa8","type":"debug","z":"d39b9be8.95c69","name":"SIGNAL-OFF","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":860,"y":1260,"wires":[]},{"id":"c477060d.9253e","type":"alexa-home","z":"30164f4b.56c61","conf":"16329d6f.9c512b","device":"81521","acknoledge":true,"name":"tivu serale","topic":"","x":940,"y":80,"wires":[["59193ec3.6b3f6"]]},{"id":"4e88638b.071e14","type":"alexa-home","z":"30164f4b.56c61","conf":"16329d6f.9c512b","device":"81522","acknoledge":true,"name":"intrattenimento","topic":"","x":980,"y":480,"wires":[["764b7fb6.6ab6a8"]]},{"id":"34e691ac.f8d20e","type":"change","z":"30164f4b.56c61","name":"Set global temperature","rules":[{"t":"set","p":"temperature","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":1060,"wires":[[]]},{"id":"fde9bb8b.298eb8","type":"debug","z":"30164f4b.56c61","name":"Termometro sala","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":740,"y":1020,"wires":[]},{"id":"47b81925.936d38","type":"inject","z":"30164f4b.56c61","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":1100,"wires":[["38bd0cfe.52b45c"]]},{"id":"983090aa.39831","type":"alexa-home","z":"30164f4b.56c61","conf":"16329d6f.9c512b","device":"83314","acknoledge":false,"name":"termostato","topic":"","x":100,"y":860,"wires":[["691db7ab.639d08","7d8f0a47.395b7c"]]},{"id":"691db7ab.639d08","type":"switch","z":"30164f4b.56c61","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"},{"t":"eq","v":"SetTargetTemperatureRequest","vt":"str"},{"t":"eq","v":"IncrementTargetTemperatureRequest","vt":"str"},{"t":"eq","v":"DecrementTargetTemperatureRequest","vt":"str"},{"t":"eq","v":"GetTemperatureReadingRequest","vt":"str"}],"checkall":"false","repair":false,"outputs":6,"x":270,"y":840,"wires":[[],[],[],[],[],["15cce85f.e5907"]]},{"id":"7d8f0a47.395b7c","type":"debug","z":"30164f4b.56c61","name":"Alexa Termostato Input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":160,"y":940,"wires":[]},{"id":"3d468024.e63288","type":"alexa-home-resp","z":"30164f4b.56c61","x":600,"y":900,"wires":[]},{"id":"15cce85f.e5907","type":"function","z":"30164f4b.56c61","name":"","func":"var temperature = global.get(\"temperature\");\n\n\nmsg.extra = {\n    \"temperatureReading\": {\n        \"value\": temperature\n    },\n    \"applianceResponseTimestamp\": new Date().toISOString()\n};\nmsg.payload = true;\nreturn msg; ","outputs":1,"noerr":0,"x":410,"y":880,"wires":[["3d468024.e63288","a6bd148a.0251e8"]]},{"id":"a6bd148a.0251e8","type":"debug","z":"30164f4b.56c61","name":"Alexa Termostato Response","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":620,"y":840,"wires":[]},{"id":"b6422c4.702bdd","type":"alexa-home","z":"d39b9be8.95c69","conf":"16329d6f.9c512b","device":"108565","acknoledge":true,"name":"cancello","topic":"","x":580,"y":2400,"wires":[["f212f05c.170898","e4f45316.f5eff"]]},{"id":"e4f45316.f5eff","type":"debug","z":"d39b9be8.95c69","name":"CANCELLO ALEXA","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":910,"y":2500,"wires":[]}]